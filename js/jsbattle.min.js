var JsBattle=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{},id:r,loaded:false};e[r].call(i.exports,i,i.exports,n);i.loaded=true;return i.exports}n.m=e;n.c=t;n.p="";return n(0)}([function(e,t,n){"use strict";var r=n(1);var i=_(r);var o=n(25);var a=_(o);var s=n(26);var u=_(s);var l=n(46);var f=_(l);var c=n(51);var h=_(c);var d=n(57);var p=_(d);function _(e){return e&&e.__esModule?e:{default:e}}e.exports={createSimulation:function e(t){t=t?t:new a.default;var n=new i.default(t);return n},createAiDefinition:function e(){return new p.default},createRenderer:function e(t){switch(t){case"debug":return new u.default;case"bw":return new f.default;case"brody":return new h.default;default:throw"Unknown rederer "+t}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var o=n(2);var a=O(o);var s=n(3);var u=O(s);var l=n(4);var f=O(l);var c=n(5);var h=O(c);var d=n(6);var p=O(d);var _=n(7);var y=O(_);var v=n(11);var m=O(v);var b=n(14);var g=O(b);var k=n(15);var w=O(k);function O(e){return e&&e.__esModule?e:{default:e}}function x(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var P=function(){function e(t){x(this,e);this._aiList=[];this._allTankList=[];this._tankList=[];this._bulletList=[];this._explodedTankList=[];this._explodedBulletList=[];this._battlefield=new h.default;this._simulationTimeout=null;this._renderInterval=null;this._simulationStepDuration=17;this._renderStepDuration=30;this._renderer=t;this._isRunning=false;this._collisionResolver=new y.default;this._rngSeed=(new Date).getTime();this._rng=(0,w.default)(this._rngSeed);this._speedMultiplier=1;this._onSimulationStepCallback=[];this._onRenderStepCallback=[];this._onFinishCallback=[];this._onErrorCallback=[];this._onStartCallback=[];this._timeElapsed=0;this._timeLimit=3e4;this._eventStore=new p.default;this._nextTankId=1;this._nextBulletId=1;this._rendererQuality="auto";this._perfMon=new g.default;this._perfMon.setSimulationStepDuration(this._simulationStepDuration/this._speedMultiplier);this._callStackLimit=Number.MAX_VALUE;this._callStackCount=0;this._teamMap=[];this._teamList=[];Math.random=this._rng}i(e,[{key:"init",value:function e(t,n){this._battlefield.setSize(t,n);this._renderer.initBatlefield(this._battlefield);this._collisionResolver.updateBattlefield(this._battlefield)}},{key:"start",value:function e(){this._isRunning=true;var t=void 0;var n=this;if(this._renderInterval){clearInterval(this._renderInterval);this._renderInterval=null}this._activateAi(function(){n._renderInterval=setInterval(function(){n._updateView()},n._renderStepDuration);if(n._simulationTimeout){clearTimeout(n._simulationTimeout)}n._perfMon.start();for(t=0;t<n._onStartCallback.length;t++){n._onStartCallback[t]()}n._simulationStep()},function(e){console.error(e);for(t=0;t<n._onErrorCallback.length;t++){n._onErrorCallback[t](e.message?e.message:"Error during simulation")}})}},{key:"_simulationStep",value:function e(){this._perfMon.onSimulationStep();var t=(new Date).getTime();var n=this;var r=void 0;this._updateModel();this._updateAi(function(){if(n._simulationTimeout){clearTimeout(n._simulationTimeout);n._simulationTimeout=null}if(n._getTeamsLeft()<=1||n._timeElapsed==n._timeLimit){n.stop();n._updateModel();n._updateView();for(r=0;r<n._onFinishCallback.length;r++){n._onFinishCallback[r]()}}if(n._isRunning){var e=(new Date).getTime()-t;var i=n._simulationStepDuration-e;i/=n._speedMultiplier;i=Math.round(i);for(r=0;r<n._onSimulationStepCallback.length;r++){n._onSimulationStepCallback[r]()}n._timeElapsed=Math.min(n._timeElapsed+n._simulationStepDuration,n._timeLimit);if(i>0){n._callStackCount=0;n._simulationTimeout=setTimeout(n._simulationStep.bind(n),i)}else if(n._callStackCount>=n._callStackLimit){n._simulationTimeout=setTimeout(n._simulationStep.bind(n),1)}else{n._callStackCount++;n._simulationStep()}}},function(e){console.error(e);for(r=0;r<n._onErrorCallback.length;r++){n._onErrorCallback[r](e.message?e.message:"Error during simulation")}})}},{key:"addTank",value:function e(t){if((typeof t==="undefined"?"undefined":r(t))!="object"){throw"AI definition must be an object"}if(!this._battlefield){throw"Simulation not initialized"}if(!t.teamName){throw"Team name cannot be empty!"}var n=this._battlefield.getStartSlot();if(!n){throw"No free space in the battlefield"}var i=this._createTank(t);i.randomize();i.moveTo(n.x,n.y);this._tankList.push(i);this._allTankList.push(i);if(this._allTankList.length>2){this._timeLimit+=2e3}if(!this._teamMap[t.teamName]){this._teamMap[t.teamName]=new u.default(t.teamName);this._teamList.push(this._teamMap[t.teamName])}this._teamMap[t.teamName].addTank(i);var o=this._createAiWrapper(i,t);this._aiList.push(o);return o}},{key:"setSpeed",value:function e(t){this._speedMultiplier=Math.max(.01,Number(t));this._perfMon.setSimulationStepDuration(this._simulationStepDuration/this._speedMultiplier);this._renderer.setSpeed(t)}},{key:"setRendererQuality",value:function e(t){if(isNaN(t)&&t!="auto")return;if(!isNaN(t)){t=Math.min(1,Math.max(0,t))}this._rendererQuality=t}},{key:"stop",value:function e(){this._isRunning=false;this._perfMon.stop();this._renderer.stop();if(this._simulationTimeout){clearTimeout(this._simulationTimeout);this._simulationTimeout=null}if(this._renderInterval){clearInterval(this._renderInterval);this._renderInterval=null}var t=void 0,n=void 0;for(n=0;n<this._aiList.length;n++){t=this._aiList[n];if(!t)continue;t.deactivate()}this._aiList=[]}},{key:"onStep",value:function e(t){this._onSimulationStepCallback.push(t)}},{key:"onRender",value:function e(t){this._onRenderStepCallback.push(t)}},{key:"onStart",value:function e(t){this._onStartCallback.push(t)}},{key:"onFinish",value:function e(t){this._onFinishCallback.push(t)}},{key:"onError",value:function e(t){this._onErrorCallback.push(t)}},{key:"_activateAi",value:function e(t,n){this._runInSequence(this._aiList,"activate",this._rngSeed,t,n)}},{key:"_updateAi",value:function e(t,n){this._runInSequence(this._aiList,"simulationStep",null,t,n)}},{key:"_runInSequence",value:function e(t,n,r,i,o){if(t.length==0){return i()}function a(){var e=[];var t=arguments[1];var n=arguments[0];for(var r=2;r<arguments.length;r++){e.push(arguments[r])}return function(r){t.apply(n,e.concat(r))}}var s=null;var u=a(s,i);var l=a(s,o);var f=void 0;if(r){f=a(t[t.length-1],t[t.length-1][n],r,u,l)}else{f=a(t[t.length-1],t[t.length-1][n],u,l)}for(var c=t.length-2;c>=0;c--){if(r){f=a(t[c],t[c][n],r,f,l)}else{f=a(t[c],t[c][n],f,l)}}f()}},{key:"_updateModel",value:function e(){var t=void 0,n=void 0,r=void 0,i=void 0;for(t=0;t<this._tankList.length;t++){n=this._tankList[t];if(!n)continue;n.simulationStep(this._collisionResolver)}var o=0;for(t=0;t<this._tankList.length;t++){n=this._tankList[t];if(!n)continue;if(n.energy<=0){o++;this._tankList[t]=null;this._explodedTankList.push(n);this._collisionResolver.removeTank(n);this._eventStore.add("tank_"+n.id,{type:"destroy",tank:n})}}var a=[];for(t=0;t<this._aiList.length;t++){i=this._aiList[t];if(!i)continue;if(i.tank.energy<=0){this._aiList[t]=null;i.deactivate();continue}a.push(i)}this._aiList=a;for(t=0;t<this._tankList.length;t++){n=this._tankList[t];if(!n)continue;if(n.isShooting){var s=n.handleShoot();r=this._createBullet(n,s);this._bulletList.push(r);this._eventStore.add("tank_"+n.id,{type:"shoot",tank:n,bullet:r})}}for(t=0;t<this._tankList.length;t++){n=this._tankList[t];if(!n)continue;for(var u=0;u<o;u++){n.onSurviveScore()}}var l=void 0;for(t=0;t<this._bulletList.length;t++){r=this._bulletList[t];if(!r)continue;r.simulationStep();l=this._collisionResolver.hitTestBullet(r);if(l){this._bulletList[t]=null;this._explodedBulletList.push(r);this._collisionResolver.removeBullet(r);this._eventStore.add("bullet_"+r.id,{type:"explode",bullet:r})}}for(t in this._teamMap){this._teamMap[t].processMessages()}}},{key:"_updateView",value:function e(){if(this._rendererQuality=="auto"){this._renderer.quality=this._perfMon.qualityLevel}else{this._renderer.quality=this._rendererQuality}var t=void 0,n=void 0,r=void 0;this._renderer.preRender();this._renderer.renderClock(this._timeElapsed,this._timeLimit);for(t=0;t<this._tankList.length;t++){n=this._tankList[t];if(!n)continue;this._renderer.renderTank(n,this._eventStore.get("tank_"+n.id))}for(t=0;t<this._bulletList.length;t++){r=this._bulletList[t];if(!r)continue;this._renderer.renderBullet(r,this._eventStore.get("bullet_"+r.id))}while(this._explodedTankList.length){n=this._explodedTankList.pop();this._renderer.renderTank(n,this._eventStore.get("tank_"+n.id))}while(this._explodedBulletList.length){r=this._explodedBulletList.pop();this._renderer.renderBullet(r,this._eventStore.get("bullet_"+r.id))}this._renderer.renderTankStats(this._allTankList);this._renderer.postRender();for(t=0;t<this._onRenderStepCallback.length;t++){this._onRenderStepCallback[t]()}this._eventStore.clear()}},{key:"_getTeamsLeft",value:function e(){var t=0;for(var n in this._teamMap){if(!this._teamMap[n].isAlive)continue;t++}return t}},{key:"_createAiWrapper",value:function e(t,n){return new m.default(t,n)}},{key:"_createTank",value:function e(t){var n=new a.default(t,this._nextTankId++);return n}},{key:"_createBullet",value:function e(t,n){var r=new f.default(t,this._nextBulletId++,n);return r}},{key:"tankList",get:function e(){return this._allTankList}},{key:"teamList",get:function e(){return this._teamList}},{key:"renderer",get:function e(){return this._renderer}},{key:"battlefield",get:function e(){return this._battlefield}},{key:"timeElapsed",get:function e(){return this._timeElapsed}},{key:"timeLimit",get:function e(){return this._timeLimit},set:function e(t){this._timeLimit=t}}]);return e}();t.default=P},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e){while(e>180){e-=360}while(e<-180){e+=360}return e}var a=function(){function e(t,r){i(this,e);if((typeof t==="undefined"?"undefined":n(t))!="object"){throw"AI definition must be an object"}this._id=r;this._name=t.name;this._team=null;this._maxEnergy=100;this._energy=this._maxEnergy;this._x=0;this._y=0;this._lastX=0;this._lastY=0;this._angle=0;this._gunAngle=0;this._radarAngle=0;this._throttle=0;this._actualThrottle=0;this._speed=0;this._turn=0;this._gunTurn=0;this._radarTurn=0;this._wallHit=false;this._enemyHit=false;this._allyHit=false;this._beingRammed=false;this._radarRange=300;this._radarFocal=6;this._enemySpot=null;this._allySpot=null;this._bulletsSpot=[];this._gunReloadTime=70;this._gunTimer=0;this._shootingPower=0;this._targetingAlarmTimer=0;this._debugData={};this._score=0;this._state=null;this._hasBoost=false;this._maxBoost=400;this._boost=this._maxBoost;this._wallDistance=null;this._skin="zebra"}r(e,[{key:"onEnemyHitScore",value:function e(t){this._score+=t}},{key:"onEnemyKillScore",value:function e(){this._score+=20}},{key:"onSurviveScore",value:function e(){this._score+=10}},{key:"setThrottle",value:function e(t){this._throttle=Math.min(1,Math.max(-1,t))}},{key:"setTurn",value:function e(t){this._turn=Math.min(1,Math.max(-1,t))}},{key:"setGunTurn",value:function e(t){this._gunTurn=Math.min(1,Math.max(-1,t))}},{key:"setRadarTurn",value:function e(t){this._radarTurn=Math.min(1,Math.max(-1,t))}},{key:"setBoost",value:function e(t){this._hasBoost=t?true:false}},{key:"setDebugData",value:function e(t){this._debugData=t}},{key:"onWallHit",value:function e(){this._wallHit=true;this.onDamage(.2)}},{key:"onEnemyHit",value:function e(){this._enemyHit=true;this.onDamage(.2)}},{key:"onAllyHit",value:function e(){this._allyHit=true;this.onDamage(.2)}},{key:"onBeingRam",value:function e(t){this._beingRammed=true;this.onDamage(.1+Math.round(t*8)*.1)}},{key:"onEnemySpot",value:function e(t){this._enemySpot=t}},{key:"onAllySpot",value:function e(t){this._allySpot=t}},{key:"onBulletSpot",value:function e(t){this._bulletsSpot.push(t)}},{key:"onWallSpot",value:function e(t){this._wallDistance=t}},{key:"onTargetingAlarm",value:function e(){this._targetingAlarmTimer=3}},{key:"isAlly",value:function e(t){if(!this._team)return false;if(!t.team)return false;return this._team.name==t.team.name}},{key:"onDamage",value:function e(t){this._energy=Math.max(0,this._energy-t)}},{key:"moveTo",value:function e(t,n){this._x=t;this._y=n;this._lastX=t;this._lastY=n}},{key:"handleShoot",value:function e(){var t=this._shootingPower;this._shootingPower=0;return t}},{key:"shoot",value:function e(t){t=Math.max(.1,Math.min(1,t));if(!this.isReloading){this._gunTimer=Math.round(t*this._gunReloadTime);this._shootingPower=t}}},{key:"randomize",value:function e(){this._angle=Math.round(360*Math.random())-180}},{key:"init",value:function e(t){if(t&&t.SKIN){this._skin=t.SKIN}}},{key:"simulationStep",value:function e(t){var n=this;if(n._energy==0){return}if(n._hasBoost&&n._boost>0){n._boost--}var r=n._x;var i=n._y;var a=n._throttle*(n.hasBoost?4:2);var s=n.hasBoost?10:20;n._actualThrottle+=(a-n._actualThrottle)/s;var u=n._actualThrottle;var l=n._angle*(Math.PI/180);n._x+=u*Math.cos(l);n._y+=u*Math.sin(l);n._wallHit=false;n._enemyHit=false;n._allyHit=false;var f=!t.checkTank(n);if(f){n._x=r;n._y=i;n._actualThrottle=0}if(this._beingRammed){n._enemyHit=true;this._beingRammed=false}n._angle+=2*n._turn;n._radarAngle+=6*n._radarTurn;n._gunAngle+=3*n._gunTurn;n._angle=o(n._angle);n._radarAngle=o(n._radarAngle);n._gunAngle=o(n._gunAngle);t.updateTank(n);n._enemySpot=null;n._allySpot=null;n._wallDistance=null;n._targetingAlarmTimer=Math.max(0,n._targetingAlarmTimer-1);t.scanTanks(n);t.scanBullets(n);t.scanWalls(n);if(n._gunTimer>0){n._gunTimer--}var c=null;var h=null;var d=[];while(n._bulletsSpot.length){var p=n._bulletsSpot.shift();d.push({id:p.id,x:p.x,y:p.y,angle:p.angle,speed:p.speed,damage:p.damage})}if(n._enemySpot){c={id:n._enemySpot.id,x:n._enemySpot.x,y:n._enemySpot.y,angle:n._enemySpot.angle,speed:n._enemySpot.speed,energy:n._enemySpot.energy}}if(n._allySpot){h={id:n._allySpot.id,x:n._allySpot.x,y:n._allySpot.y,angle:n._allySpot.angle,speed:n._allySpot.speed,energy:n._allySpot.energy}}var _=n._x-n._lastX;var y=n._y-n._lastY;n._speed=Math.sqrt(_*_+y*y);n._lastX=n._x;n._lastY=n._y;n._state={x:n._x,y:n._y,angle:n._angle,energy:n._energy,boost:n._boost,collisions:{wall:n._wallHit,enemy:n._enemyHit,ally:n._allyHit},radar:{angle:n._radarAngle,targetingAlarm:n.targetingAlarm,wallDistance:n._wallDistance,enemy:c,ally:h,bullets:d},gun:{angle:n._gunAngle,reloading:n.isReloading},radio:{inbox:n.team?n.team.getMessages(n.id):[]}}}},{key:"id",get:function e(){return this._id}},{key:"skin",get:function e(){return this._skin}},{key:"state",get:function e(){return this._state}},{key:"energy",get:function e(){return this._energy}},{key:"score",get:function e(){return this._score}},{key:"maxEnergy",get:function e(){return this._maxEnergy}},{key:"radarRange",get:function e(){return this._radarRange}},{key:"radarFocal",get:function e(){return this._radarFocal}},{key:"name",get:function e(){return this._name}},{key:"fullName",get:function e(){return this._name+" #"+this._id}},{key:"team",get:function e(){return this._team}},{key:"x",get:function e(){return this._x}},{key:"y",get:function e(){return this._y}},{key:"speed",get:function e(){return this._speed}},{key:"gunLength",get:function e(){return 25}},{key:"angle",get:function e(){return this._angle}},{key:"throttle",get:function e(){return this._throttle}},{key:"hasBoost",get:function e(){return this._hasBoost&&this._boost>0}},{key:"boost",get:function e(){return this._boost}},{key:"maxBoost",get:function e(){return this._maxBoost}},{key:"gunAngle",get:function e(){return this._gunAngle}},{key:"radarAngle",get:function e(){return this._radarAngle}},{key:"enemySpot",get:function e(){return this._enemySpot}},{key:"allySpot",get:function e(){return this._allySpot}},{key:"targetingAlarm",get:function e(){return this._targetingAlarmTimer>0}},{key:"debugData",get:function e(){return this._debugData}},{key:"isShooting",get:function e(){return this._shootingPower>0}},{key:"shootingPower",get:function e(){return this._shootingPower}},{key:"isReloading",get:function e(){return this._gunTimer>0}}]);return e}();t.default=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t){r(this,e);this._name=t;this._members=[];this._inboxMap=[];this._outboxMap=[]}n(e,[{key:"addTank",value:function e(t){if(t.team)throw"Tank "+t.fullName+" is already assigned to team "+t.team.name;for(var n in this._members){if(this._members[n].id==t.id)return}this._members.push(t);t._team=this;this._inboxMap[t.id]=[];this._outboxMap[t.id]=[]}},{key:"getMessages",value:function e(t){return this._outboxMap[t]}},{key:"sendMessages",value:function e(t,n){for(var r in this._inboxMap){if(r==t)continue;this._inboxMap[r]=this._inboxMap[r].concat(n)}}},{key:"processMessages",value:function e(){var t=void 0;for(t in this._inboxMap){this._outboxMap[t]=this._inboxMap[t];this._inboxMap[t]=[]}}},{key:"size",get:function e(){return this._members.length}},{key:"name",get:function e(){return this._name}},{key:"aliveCount",get:function e(){var t=0;for(var n=0;n<this._members.length;n++){if(this._members[n].energy>0){t++}}return t}},{key:"score",get:function e(){var t=0;for(var n=0;n<this._members.length;n++){t+=this._members[n].score}return t}},{key:"energy",get:function e(){var t=0;for(var n=0;n<this._members.length;n++){t+=this._members[n].energy}return t}},{key:"maxEnergy",get:function e(){var t=0;for(var n=0;n<this._members.length;n++){t+=this._members[n].maxEnergy}return t}},{key:"isAlive",get:function e(){return this.aliveCount>0}},{key:"members",get:function e(){return this._members}}]);return e}();t.default=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t,n,i){r(this,e);this._id=n;this._owner=t;this._angle=t.angle+t.gunAngle;while(this._angle>180){this._angle-=360}while(this._angle<-180){this._angle+=360}this._x=t.x+t.gunLength*Math.cos(this._angle*(Math.PI/180));this._y=t.y+t.gunLength*Math.sin(this._angle*(Math.PI/180));this._speed=4;this._power=i;this._damage=Math.round(1e3*i+300*i*i)*.01;this._exploded=false}n(e,[{key:"onWallHit",value:function e(){this._exploded=true}},{key:"onEnemyHit",value:function e(t){this._exploded=true;t.onDamage(this._damage)}},{key:"simulationStep",value:function e(){this._x+=this._speed*Math.cos(this._angle*(Math.PI/180));this._y+=this._speed*Math.sin(this._angle*(Math.PI/180))}},{key:"id",get:function e(){return this._id}},{key:"x",get:function e(){return this._x}},{key:"y",get:function e(){return this._y}},{key:"angle",get:function e(){return this._angle}},{key:"speed",get:function e(){return this._speed}},{key:"damage",get:function e(){return this._damage}},{key:"power",get:function e(){return this._power}},{key:"owner",get:function e(){return this._owner}},{key:"exploded",get:function e(){return this._exploded}}]);return e}();t.default=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t,n){r(this,e);this._width=null;this._height=null;this._startSlotList=[];this._offsetX=Math.round(Math.random()*1e4-5e3);this._offsetY=Math.round(Math.random()*1e4-5e3)}n(e,[{key:"setSize",value:function e(t,n){this._width=t-this.margin*2;this._height=n-this.margin*2;this._startSlotList=[];var r=90;for(var i=this.minX+r;i<this.maxX-r;i+=r){for(var o=this.minY+r;o<this.maxY-r;o+=r){this._startSlotList.push({x:i,y:o})}}var a=this._startSlotList.length,s=void 0,u=void 0;while(0!==a){u=Math.floor(Math.random()*a);a-=1;s=this._startSlotList[a];this._startSlotList[a]=this._startSlotList[u];this._startSlotList[u]=s}}},{key:"getStartSlot",value:function e(){if(this._startSlotList.length){return this._startSlotList.pop()}return null}},{key:"width",get:function e(){return this._width}},{key:"height",get:function e(){return this._height}},{key:"margin",get:function e(){return 25}},{key:"minX",get:function e(){return this._offsetX+this.margin}},{key:"minY",get:function e(){return this._offsetY+this.margin}},{key:"maxX",get:function e(){return this._offsetX+this._width+this.margin}},{key:"maxY",get:function e(){return this._offsetY+this._height+this.margin}},{key:"offsetX",get:function e(){return this._offsetX}},{key:"offsetY",get:function e(){return this._offsetY}}]);return e}();t.default=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(){r(this,e);this._data=[]}n(e,[{key:"add",value:function e(t,n){if(!this._data[t]){this._data[t]=[]}this._data[t].push(n)}},{key:"get",value:function e(t){if(!this._data[t]){this._data[t]=[]}return this._data[t]}},{key:"clear",value:function e(t){this._data=[]}}]);return e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(8);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var u=function(){function e(){s(this,e);this._wallList=[];this._tankMap=[];this._bulletMap=[];this._radarBeamMap=[];this._battlefield=null}r(e,[{key:"updateBattlefield",value:function e(t){this._battlefield={minX:t.minX,minY:t.minY,maxX:t.maxX,maxY:t.maxY};var n=void 0;n=new o.default.Box(new o.default.Vector(t.minX-10,t.minY),10,t.height).toPolygon();this._wallList.push(n);n=new o.default.Box(new o.default.Vector(t.minX,t.minY-10),t.width,10).toPolygon();this._wallList.push(n);n=new o.default.Box(new o.default.Vector(t.maxX,t.minY),10,t.height).toPolygon();this._wallList.push(n);n=new o.default.Box(new o.default.Vector(t.minX,t.maxY),t.width,10).toPolygon();this._wallList.push(n)}},{key:"updateTank",value:function e(t){var n=this._getTankShape(t);n.pos.x=t.x;n.pos.y=t.y}},{key:"removeBullet",value:function e(t){this._bulletMap[t.id]=null}},{key:"removeTank",value:function e(t){this._tankMap[t.id]=null;this._radarBeamMap[t.id]=null}},{key:"hitTestBullet",value:function e(t){var n=this._getBulletShape(t);var r=t.owner.energy?this._getTankShape(t.owner):null;n.pos.x=t.x;n.pos.y=t.y;var i=void 0;var a=void 0;var s=void 0;for(i in this._wallList){s=this._wallList[i];a=o.default.testCirclePolygon(n,s);if(a){t.onWallHit();return true}}var u=void 0;for(i in this._tankMap){u=this._tankMap[i];if(!u)continue;if(u==r){continue}a=o.default.testCircleCircle(n,u);if(a){var l=u.tank.energy;t.onEnemyHit(u.tank);t.owner.onEnemyHitScore(l-u.tank.energy);if(u.tank.energy==0){t.owner.onEnemyKillScore()}return true}}return false}},{key:"checkTank",value:function e(t){var n=this._getTankShape(t);n.pos.x=t.x;n.pos.y=t.y;var r=void 0;var i=void 0;var a=void 0;for(r in this._wallList){a=this._wallList[r];i=o.default.testCirclePolygon(n,a);if(i){t.onWallHit();return false}}var s=void 0;for(r in this._tankMap){s=this._tankMap[r];if(!s)continue;if(s==n){continue}i=o.default.testCircleCircle(n,s);var u=t.isAlly(s.tank);if(i){if(!u){var l=s.tank.energy;t.onEnemyHit();s.tank.onBeingRam(t.speed);t.onEnemyHitScore(l-s.tank.energy);return false}else{t.onAllyHit();return false}}}return true}},{key:"scanTanks",value:function e(t){var n=this._getRadarBeamShape(t);var r=this._getTankShape(t);n.setAngle((t.angle+t.radarAngle)*Math.PI/180);n.pos.x=t.x;n.pos.y=t.y;var i=void 0;var a=void 0;var s=void 0;var u=[];for(i in this._tankMap){a=this._tankMap[i];if(!a)continue;if(a==r){continue}s=o.default.testPolygonCircle(n,a);if(s){u.push(a.tank)}}if(u.length==0){return false}var l=null;var f=t.radarRange;var c=null;var h=t.radarRange;var d=void 0,p=void 0,_=void 0,y=void 0;for(i in u){p=u[i].x-t.x;_=u[i].y-t.y;d=Math.sqrt(p*p+_*_);y=u[i].isAlly(t);if(!y&&(!l||d<f)){l=u[i];f=d}else if(y&&(!c||d<h)){c=u[i];h=d}}if(c){t.onAllySpot(c)}if(l){t.onEnemySpot(l);l.onTargetingAlarm()}return true}},{key:"scanBullets",value:function e(t){var n=this._getRadarBeamShape(t);n.setAngle((t.angle+t.radarAngle)*Math.PI/180);n.pos.x=t.x;n.pos.y=t.y;var r=void 0;var i=void 0;var a=void 0;var s=false;for(r in this._bulletMap){a=this._bulletMap[r];if(!a)continue;if(a.bullet.owner==t)continue;i=o.default.testCirclePolygon(a,n);if(i){t.onBulletSpot(a.bullet);s=true}}return s}},{key:"scanWalls",value:function e(t){var n=this._getWallDistance(t);if(n<t.radarRange){t.onWallSpot(n);return true}return false}},{key:"_getWallDistance",value:function e(t){var n=t.angle+t.radarAngle;while(n>180){n-=360}while(n<-180){n+=360}var r=t.y-this._battlefield.minY;var i=this._battlefield.maxY-t.y;var o=t.x-this._battlefield.minX;var a=this._battlefield.maxX-t.x;if(n==-180||n==180){return o}else if(n==0){return a}else if(n==-90){return r}else if(n==90){return i}var s=void 0,u=void 0;if(n>-180&&n<-90){s=o/Math.cos((n+180)*(Math.PI/180));u=r/Math.sin((n+180)*(Math.PI/180))}else if(n>-90&&n<0){s=a/Math.cos(-n*(Math.PI/180));u=r/Math.sin(-n*(Math.PI/180))}else if(n>0&&n<90){s=a/Math.cos(n*(Math.PI/180));u=i/Math.sin(n*(Math.PI/180))}else{s=o/Math.cos((180-n)*(Math.PI/180));u=i/Math.sin((180-n)*(Math.PI/180))}return Math.min(s,u)}},{key:"_getTankShape",value:function e(t){if(!this._tankMap[t.id]){if(t.energy==0){throw"Cannot create shape for destroyed tank"}var n=new o.default.Circle(new o.default.Vector(t.x,t.y),18);this._tankMap[t.id]=n;n.tank=t}return this._tankMap[t.id]}},{key:"_getBulletShape",value:function e(t){if(!this._bulletMap[t.id]){if(t.exploded){throw"Cannot create shape for exploded bullet"}var n=new o.default.Circle(new o.default.Vector(t.x,t.y),3);this._bulletMap[t.id]=n;n.bullet=t}return this._bulletMap[t.id]}},{key:"_getRadarBeamShape",value:function e(t){if(!this._radarBeamMap[t.id]){if(t.energy==0){throw"Cannot create radar beam shape for destroyed tank"}var n=t.radarRange*Math.tan(t.radarFocal*(Math.PI/180))/2;var r=new o.default.Polygon(new o.default.Vector(t.x,t.y),[new o.default.Vector(0,3),new o.default.Vector(0,-3),new o.default.Vector(t.radarRange,-n),new o.default.Vector(t.radarRange,n)]);this._radarBeamMap[t.id]=r;r.tank=t}return this._radarBeamMap[t.id]}}]);return e}();t.default=u},function(e,t,n){var r,i;(function(e){"use strict";var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};/** @preserve SAT.js - Version 0.6.0 - Copyright 2012 - 2016 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */
(function(a,s){"use strict";if("function"==="function"&&n(10)["amd"]){!(r=s,i=typeof r==="function"?r.call(t,n,t,e):r,i!==undefined&&(e.exports=i))}else if((false?"undefined":o(t))==="object"){e["exports"]=s()}else{a["SAT"]=s()}})(undefined,function(){"use strict";var e={};function t(e,t){this["x"]=e||0;this["y"]=t||0}e["Vector"]=t;e["V"]=t;t.prototype["copy"]=t.prototype.copy=function(e){this["x"]=e["x"];this["y"]=e["y"];return this};t.prototype["clone"]=t.prototype.clone=function(){return new t(this["x"],this["y"])};t.prototype["perp"]=t.prototype.perp=function(){var e=this["x"];this["x"]=this["y"];this["y"]=-e;return this};t.prototype["rotate"]=t.prototype.rotate=function(e){var t=this["x"];var n=this["y"];this["x"]=t*Math.cos(e)-n*Math.sin(e);this["y"]=t*Math.sin(e)+n*Math.cos(e);return this};t.prototype["reverse"]=t.prototype.reverse=function(){this["x"]=-this["x"];this["y"]=-this["y"];return this};t.prototype["normalize"]=t.prototype.normalize=function(){var e=this.len();if(e>0){this["x"]=this["x"]/e;this["y"]=this["y"]/e}return this};t.prototype["add"]=t.prototype.add=function(e){this["x"]+=e["x"];this["y"]+=e["y"];return this};t.prototype["sub"]=t.prototype.sub=function(e){this["x"]-=e["x"];this["y"]-=e["y"];return this};t.prototype["scale"]=t.prototype.scale=function(e,t){this["x"]*=e;this["y"]*=t||e;return this};t.prototype["project"]=t.prototype.project=function(e){var t=this.dot(e)/e.len2();this["x"]=t*e["x"];this["y"]=t*e["y"];return this};t.prototype["projectN"]=t.prototype.projectN=function(e){var t=this.dot(e);this["x"]=t*e["x"];this["y"]=t*e["y"];return this};t.prototype["reflect"]=t.prototype.reflect=function(e){var t=this["x"];var n=this["y"];this.project(e).scale(2);this["x"]-=t;this["y"]-=n;return this};t.prototype["reflectN"]=t.prototype.reflectN=function(e){var t=this["x"];var n=this["y"];this.projectN(e).scale(2);this["x"]-=t;this["y"]-=n;return this};t.prototype["dot"]=t.prototype.dot=function(e){return this["x"]*e["x"]+this["y"]*e["y"]};t.prototype["len2"]=t.prototype.len2=function(){return this.dot(this)};t.prototype["len"]=t.prototype.len=function(){return Math.sqrt(this.len2())};function n(e,n){this["pos"]=e||new t;this["r"]=n||0}e["Circle"]=n;n.prototype["getAABB"]=n.prototype.getAABB=function(){var e=this["r"];var n=this["pos"].clone().sub(new t(e,e));return new i(n,e*2,e*2).toPolygon()};function r(e,n){this["pos"]=e||new t;this["angle"]=0;this["offset"]=new t;this.setPoints(n||[])}e["Polygon"]=r;r.prototype["setPoints"]=r.prototype.setPoints=function(e){var n=!this["points"]||this["points"].length!==e.length;if(n){var r;var i=this["calcPoints"]=[];var o=this["edges"]=[];var a=this["normals"]=[];for(r=0;r<e.length;r++){i.push(new t);o.push(new t);a.push(new t)}}this["points"]=e;this._recalc();return this};r.prototype["setAngle"]=r.prototype.setAngle=function(e){this["angle"]=e;this._recalc();return this};r.prototype["setOffset"]=r.prototype.setOffset=function(e){this["offset"]=e;this._recalc();return this};r.prototype["rotate"]=r.prototype.rotate=function(e){var t=this["points"];var n=t.length;for(var r=0;r<n;r++){t[r].rotate(e)}this._recalc();return this};r.prototype["translate"]=r.prototype.translate=function(e,t){var n=this["points"];var r=n.length;for(var i=0;i<r;i++){n[i].x+=e;n[i].y+=t}this._recalc();return this};r.prototype._recalc=function(){var e=this["calcPoints"];var t=this["edges"];var n=this["normals"];var r=this["points"];var i=this["offset"];var o=this["angle"];var a=r.length;var s;for(s=0;s<a;s++){var u=e[s].copy(r[s]);u.x+=i.x;u.y+=i.y;if(o!==0){u.rotate(o)}}for(s=0;s<a;s++){var l=e[s];var f=s<a-1?e[s+1]:e[0];var c=t[s].copy(f).sub(l);n[s].copy(c).perp().normalize()}return this};r.prototype["getAABB"]=r.prototype.getAABB=function(){var e=this["calcPoints"];var n=e.length;var r=e[0]["x"];var o=e[0]["y"];var a=e[0]["x"];var s=e[0]["y"];for(var u=1;u<n;u++){var l=e[u];if(l["x"]<r){r=l["x"]}else if(l["x"]>a){a=l["x"]}if(l["y"]<o){o=l["y"]}else if(l["y"]>s){s=l["y"]}}return new i(this["pos"].clone().add(new t(r,o)),a-r,s-o).toPolygon()};function i(e,n,r){this["pos"]=e||new t;this["w"]=n||0;this["h"]=r||0}e["Box"]=i;i.prototype["toPolygon"]=i.prototype.toPolygon=function(){var e=this["pos"];var n=this["w"];var i=this["h"];return new r(new t(e["x"],e["y"]),[new t,new t(n,0),new t(n,i),new t(0,i)])};function o(){this["a"]=null;this["b"]=null;this["overlapN"]=new t;this["overlapV"]=new t;this.clear()}e["Response"]=o;o.prototype["clear"]=o.prototype.clear=function(){this["aInB"]=true;this["bInA"]=true;this["overlap"]=Number.MAX_VALUE;return this};var a=[];for(var s=0;s<10;s++){a.push(new t)}var u=[];for(var s=0;s<5;s++){u.push([])}var l=new o;var f=new i(new t,1e-6,1e-6).toPolygon();function c(e,t,n){var r=Number.MAX_VALUE;var i=-Number.MAX_VALUE;var o=e.length;for(var a=0;a<o;a++){var s=e[a].dot(t);if(s<r){r=s}if(s>i){i=s}}n[0]=r;n[1]=i}function h(e,t,n,r,i,o){var s=u.pop();var l=u.pop();var f=a.pop().copy(t).sub(e);var h=f.dot(i);c(n,i,s);c(r,i,l);l[0]+=h;l[1]+=h;if(s[0]>l[1]||l[0]>s[1]){a.push(f);u.push(s);u.push(l);return true}if(o){var d=0;if(s[0]<l[0]){o["aInB"]=false;if(s[1]<l[1]){d=s[1]-l[0];o["bInA"]=false}else{var p=s[1]-l[0];var _=l[1]-s[0];d=p<_?p:-_}}else{o["bInA"]=false;if(s[1]>l[1]){d=s[0]-l[1];o["aInB"]=false}else{var p=s[1]-l[0];var _=l[1]-s[0];d=p<_?p:-_}}var y=Math.abs(d);if(y<o["overlap"]){o["overlap"]=y;o["overlapN"].copy(i);if(d<0){o["overlapN"].reverse()}}}a.push(f);u.push(s);u.push(l);return false}e["isSeparatingAxis"]=h;function d(e,t){var n=e.len2();var r=t.dot(e);if(r<0){return p}else if(r>n){return y}else{return _}}var p=-1;var _=0;var y=1;function v(e,t){var n=a.pop().copy(e).sub(t["pos"]);var r=t["r"]*t["r"];var i=n.len2();a.push(n);return i<=r}e["pointInCircle"]=v;function m(e,t){f["pos"].copy(e);l.clear();var n=w(f,t,l);if(n){n=l["aInB"]}return n}e["pointInPolygon"]=m;function b(e,t,n){var r=a.pop().copy(t["pos"]).sub(e["pos"]);var i=e["r"]+t["r"];var o=i*i;var s=r.len2();if(s>o){a.push(r);return false}if(n){var u=Math.sqrt(s);n["a"]=e;n["b"]=t;n["overlap"]=i-u;n["overlapN"].copy(r.normalize());n["overlapV"].copy(r).scale(n["overlap"]);n["aInB"]=e["r"]<=t["r"]&&u<=t["r"]-e["r"];n["bInA"]=t["r"]<=e["r"]&&u<=e["r"]-t["r"]}a.push(r);return true}e["testCircleCircle"]=b;function g(e,t,n){var r=a.pop().copy(t["pos"]).sub(e["pos"]);var i=t["r"];var o=i*i;var s=e["calcPoints"];var u=s.length;var l=a.pop();var f=a.pop();for(var c=0;c<u;c++){var h=c===u-1?0:c+1;var _=c===0?u-1:c-1;var v=0;var m=null;l.copy(e["edges"][c]);f.copy(r).sub(s[c]);if(n&&f.len2()>o){n["aInB"]=false}var b=d(l,f);if(b===p){l.copy(e["edges"][_]);var g=a.pop().copy(r).sub(s[_]);b=d(l,g);if(b===y){var k=f.len();if(k>i){a.push(r);a.push(l);a.push(f);a.push(g);return false}else if(n){n["bInA"]=false;m=f.normalize();v=i-k}}a.push(g)}else if(b===y){l.copy(e["edges"][h]);f.copy(r).sub(s[h]);b=d(l,f);if(b===p){var k=f.len();if(k>i){a.push(r);a.push(l);a.push(f);return false}else if(n){n["bInA"]=false;m=f.normalize();v=i-k}}}else{var w=l.perp().normalize();var k=f.dot(w);var O=Math.abs(k);if(k>0&&O>i){a.push(r);a.push(w);a.push(f);return false}else if(n){m=w;v=i-k;if(k>=0||v<2*i){n["bInA"]=false}}}if(m&&n&&Math.abs(v)<Math.abs(n["overlap"])){n["overlap"]=v;n["overlapN"].copy(m)}}if(n){n["a"]=e;n["b"]=t;n["overlapV"].copy(n["overlapN"]).scale(n["overlap"])}a.push(r);a.push(l);a.push(f);return true}e["testPolygonCircle"]=g;function k(e,t,n){var r=g(t,e,n);if(r&&n){var i=n["a"];var o=n["aInB"];n["overlapN"].reverse();n["overlapV"].reverse();n["a"]=n["b"];n["b"]=i;n["aInB"]=n["bInA"];n["bInA"]=o}return r}e["testCirclePolygon"]=k;function w(e,t,n){var r=e["calcPoints"];var i=r.length;var o=t["calcPoints"];var a=o.length;for(var s=0;s<i;s++){if(h(e["pos"],t["pos"],r,o,e["normals"][s],n)){return false}}for(var s=0;s<a;s++){if(h(e["pos"],t["pos"],r,o,t["normals"][s],n)){return false}}if(n){n["a"]=e;n["b"]=t;n["overlapV"].copy(n["overlapN"]).scale(n["overlap"])}return true}e["testPolygonPolygon"]=w;return e})}).call(t,n(9)(e))},function(e,t){"use strict";e.exports=function(e){if(!e.webpackPolyfill){e.deprecate=function(){};e.paths=[];e.children=[];e.webpackPolyfill=1}return e}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var o=n(12);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=function(){function e(t,n){u(this,e);if(!t)throw"Tank is required";if(!n)throw"AiDefinition is required";this._tank=t;this._aiWorker=null;this._aiProcessingStart=0;this._aiProcessingCheckInterval=null;this._aiProcessingResolveCallback=null;this._aiProcessingRejectCallback=null;this._slowAiChances=10;this._onActivationCallback=[];this._onDectivationCallback=[];this._aiProcessingTimeLimit=3e3;this._aiDefinition=n;this._isReady=false;this._controlData={THROTTLE:0,BOOST:0,TURN:0,RADAR_TURN:0,GUN_TURN:0,SHOOT:0,OUTBOX:[],DEBUG:{}}}i(e,[{key:"setProcessingLimit",value:function e(t){this._aiProcessingTimeLimit=t}},{key:"onActivation",value:function e(t){this._onActivationCallback.push(t)}},{key:"onDectivation",value:function e(t){this._onDeactivationCallback.push(t)}},{key:"_formatError",value:function e(t){if(!t.message)return"unknown";var n=t.message;if(t.lineno){n="Line #"+t.lineno+": "+n}return n}},{key:"activate",value:function e(t,n,i){if(typeof t!="number")throw"seed must be a number, '"+(typeof t==="undefined"?"undefined":r(t))+"' given";if(typeof n!="function")throw"resolve callback must be a function, '"+(typeof n==="undefined"?"undefined":r(n))+"' given";if(typeof i!="function")throw"reject callback must be a function, '"+(typeof i==="undefined"?"undefined":r(i))+"' given";var o=this;o._aiWorker=o._createWorker(this._aiDefinition);o._aiWorker.onerror=function(e){console.error(e);if(o._aiProcessingRejectCallback){o._aiProcessingRejectCallback({message:"Web Worker of '"+o._tank.fullName+"' returned an error: "+o._formatError(e),performanceIssues:false,tankName:o._tank.name,tankId:o._tank.id});o._aiProcessingResolveCallback=null;o._aiProcessingRejectCallback=null}};if(o._aiProcessingCheckInterval){clearInterval(o._aiProcessingCheckInterval);o._aiProcessingCheckInterval=null}o._aiProcessingCheckInterval=setInterval(function(){if(o._aiProcessingRejectCallback){var e=(new Date).getTime();var t=e-o._aiProcessingStart;if(t>o._aiProcessingTimeLimit){clearInterval(o._aiProcessingCheckInterval);o._aiProcessingCheckInterval=null;o._aiProcessingRejectCallback({message:"Simulation cannot be continued because "+o._tank.name+" #"+o._tank.id+" does not respond",performanceIssues:true,tankName:o._tank.name,tankId:o._tank.id})}}},Math.max(o._aiDefinition.executionLimit,Math.round(o._aiProcessingTimeLimit/2)));o._aiWorker.onmessage=function(e){var t=e.data;if(o._aiProcessingResolveCallback){if(t.type=="init"){o._configureTank(t.settings?t.settings:{});o._isReady=true;for(var n=0;n<o._onActivationCallback.length;n++){o._onActivationCallback[n].bind(o)()}}else{o._controlTank(t)}var r=void 0;var i=(new Date).getTime();var a=i-o._aiProcessingStart;if(a>o._aiDefinition.executionLimit&&t.type!="init"){o._slowAiChances--;console.warn("Execution of AI for tank "+o._tank.name+" #"+o._tank.id+" takes too long ("+a+"ms). If problem repeats, AI will be terminated.");if(o._slowAiChances<=0){r=o._aiProcessingRejectCallback;o._aiProcessingResolveCallback=null;o._aiProcessingRejectCallback=null;r({message:"Simulation cannot be continued because "+o._tank.name+" #"+o._tank.id+" has performance issues",performanceIssues:true,tankName:o._tank.name,tankId:o._tank.id});return}}r=o._aiProcessingResolveCallback;o._aiProcessingResolveCallback=null;o._aiProcessingRejectCallback=null;r()}};var a=null;if(o._tank.team&&o._tank.team.size>1){a={name:o._tank.team.name,mates:o._tank.team.members.map(function(e){return e.id})}}else{a={name:o._tank.fullName,mates:[o._tank.id]}}var s={id:o._tank.id,team:a};if(o._aiDefinition.initData){s.initData=o._aiDefinition.initData}o._aiProcessingStart=(new Date).getTime();o._aiProcessingResolveCallback=n;o._aiProcessingRejectCallback=i;o._aiWorker.postMessage({command:"init",seed:t+":"+o._tank.id,settings:{SKIN:"zebra"},info:s,code:o._aiDefinition.code})}},{key:"deactivate",value:function e(){if(this._aiWorker){this._aiWorker.terminate();this._aiWorker=null}if(this._aiProcessingCheckInterval){clearInterval(this._aiProcessingCheckInterval);this._aiProcessingCheckInterval=null}for(var t=0;t<this._onDectivationCallback.length;t++){this._onDectivationCallback[t].bind(this)()}}},{key:"simulationStep",value:function e(t,n){if(typeof t!="function")throw"resolve callback must be a function, '"+(typeof t==="undefined"?"undefined":r(t))+"' given";if(typeof n!="function")throw"reject callback must be a function, '"+(typeof n==="undefined"?"undefined":r(n))+"' given";if(!this._isReady){throw"AI of "+this._tank.fullName+" not initliazed"}var i=this;if(i._aiWorker&&i._tank.energy==0){i._aiWorker.terminate();i._aiWorker=null;t();return}i._aiProcessingStart=(new Date).getTime();i._aiProcessingResolveCallback=t;i._aiProcessingRejectCallback=n;i._aiWorker.postMessage({command:"update",state:i._tank.state,control:i._controlData})}},{key:"_configureTank",value:function e(t){var n={};var r=["zebra","forest","black","tiger","desert","lava","ocean"];if(r.indexOf(t.SKIN)!=-1){n.SKIN=t.SKIN}this._tank.init(n)}},{key:"_controlTank",value:function e(t){var n=this;n._controlData.THROTTLE=Number(t.THROTTLE);n._controlData.TURN=Number(t.TURN);n._controlData.GUN_TURN=Number(t.GUN_TURN);n._controlData.RADAR_TURN=Number(t.RADAR_TURN);n._controlData.SHOOT=Number(t.SHOOT);n._controlData.DEBUG=t.DEBUG;n._controlData.BOOST=t.BOOST?1:0;n._controlData.THROTTLE=isNaN(n._controlData.THROTTLE)?0:n._controlData.THROTTLE;n._controlData.TURN=isNaN(n._controlData.TURN)?0:n._controlData.TURN;n._controlData.GUN_TURN=isNaN(n._controlData.GUN_TURN)?0:n._controlData.GUN_TURN;n._controlData.RADAR_TURN=isNaN(n._controlData.RADAR_TURN)?0:n._controlData.RADAR_TURN;n._controlData.SHOOT=isNaN(n._controlData.SHOOT)?0:n._controlData.SHOOT;n._controlData.THROTTLE=Math.min(1,Math.max(-1,Number(n._controlData.THROTTLE)));n._controlData.TURN=Math.min(1,Math.max(-1,Number(n._controlData.TURN)));n._controlData.GUN_TURN=Math.min(1,Math.max(-1,Number(n._controlData.GUN_TURN)));n._controlData.RADAR_TURN=Math.min(1,Math.max(-1,Number(n._controlData.RADAR_TURN)));n._controlData.SHOOT=Math.min(1,Math.max(0,Number(n._controlData.SHOOT)));n._tank.setThrottle(n._controlData.THROTTLE);n._tank.setBoost(n._controlData.BOOST);n._tank.setTurn(n._controlData.TURN);n._tank.setRadarTurn(n._controlData.RADAR_TURN);n._tank.setGunTurn(n._controlData.GUN_TURN);n._tank.setDebugData(n._controlData.DEBUG);if(n._controlData.SHOOT){n._tank.shoot(n._controlData.SHOOT)}n._controlData.SHOOT=0;var r=[];for(var i in t.OUTBOX){r.push(JSON.parse(JSON.stringify(t.OUTBOX[i])))}if(n._tank.team){n._tank.team.sendMessages(n._tank.id,r)}n._controlData.OUTBOX=[]}},{key:"_createWorker",value:function e(t){if(t.useSandbox){return new Worker(t.filePath)}else{return new a.default}}},{key:"tank",get:function e(){return this._tank}},{key:"worker",get:function e(){return this._aiWorker}}]);return e}();t.default=l},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var extendedMath=__webpack_require__(13);var TankController=function(){function e(){_classCallCheck(this,e);this._initCallback=function(){};this._loopCallback=function(){}}_createClass(e,[{key:"loop",value:function e(t){this._loopCallback=t}},{key:"init",value:function e(t){this._initCallback=t}}]);return e}();var EvalWorker=function(){function EvalWorker(){_classCallCheck(this,EvalWorker);this.onmessage=function(e){};this._callStackLimit=100;this._callStackCount=0;this._tankController=new TankController}_createClass(EvalWorker,[{key:"postMessage",value:function postMessage(inputData){var _this=this;var response=null;if(inputData.command=="init"){if(!inputData.code)throw"The code is required!";var settings=inputData.settings;var info=inputData.info;var Math=extendedMath();var tank=this._tankController;eval(inputData.code);tank._initCallback(settings,info);response={data:{type:"init",settings:settings}}}else if(inputData.command=="update"){var state=inputData.state;var control=inputData.control;if(this._tankController._loopCallback){this._tankController._loopCallback(state,control);response={data:control}}else{response={data:control}}}if(this._callStackCount<this._callStackLimit){this._callStackCount++;this.onmessage(response)}else{this._callStackCount=0;setTimeout(function(){_this.onmessage(response)},1)}}},{key:"terminate",value:function e(){}}]);return EvalWorker}();exports.default=EvalWorker},function(e,t){"use strict";e.exports=function(){var e={};var t=["LN10","PI","E","LOG10E","SQRT2","LOG2E","SQRT1_2","LN2","cos","pow","log","tan","sqrt","ceil","asin","abs","max","exp","atan2","random","round","floor","acos","atan","min","sin"];for(var n in t){e[t[n]]=Math[t[n]]}e.deg={};e.rad={};e.deg.normalize=function(e){e=Number(e);while(e>180){e-=360}while(e<=-180){e+=360}return e};e.rad.normalize=function(t){t=Number(t);while(t>e.PI){t-=e.PI*2}while(t<=-e.PI){t+=e.PI*2}return t};e.deg2rad=function(t){return e.rad.normalize(t*(e.PI/180))};e.rad2deg=function(t){return e.deg.normalize(t*(180/e.PI))};e.rad.atan2=e.atan2;e.deg.atan2=function(t,n){return e.rad2deg(e.rad.atan2(t,n))};e.distance=function(t,n,r,i){var o=r-t;var a=i-n;return e.sqrt(o*o+a*a)};e.randomRange=function(t,n){if(t>n)throw"The range is incorrect. First number must be lower than second";return t+e.random()*(n-t)};return e}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(){r(this,e);this._simulationStepDuration=30;this._stepCounter=0;this._checkLoop=0;this._started=false;this._desiredPerfomance=Math.floor(1e3/this._simulationStepDuration);this._actualPerfomance=this._desiredPerfomance;this._perfomanceIndex=1;this._desiredQuality=1;this._quality=this._desiredQuality;this._checkInterval=500}n(e,[{key:"start",value:function e(){this._started=true;var t=this;this._checkLoop=setInterval(function(){t._check()},this._checkInterval)}},{key:"stop",value:function e(){this._started=false;if(this._checkLoop){clearInterval(this._checkLoop);this._checkLoop=null}}},{key:"setSimulationStepDuration",value:function e(t){if(t!=this._simulationStepDuration){this._quality=this._desiredQuality}this._simulationStepDuration=t;this._desiredPerfomance=Math.floor(1e3/t)}},{key:"onSimulationStep",value:function e(){if(this._started){this._stepCounter++}}},{key:"_check",value:function e(){this._actualPerfomance=Math.ceil(this._stepCounter*(1e3/this._checkInterval));this._stepCounter=0;var t=this._desiredPerfomance?this._actualPerfomance/this._desiredPerfomance:1;this._perfomanceIndex=(this._perfomanceIndex+t)/2;this._updateQuality()}},{key:"_updateQuality",value:function e(){var t=2.5*this._perfomanceIndex-1.25;t=Math.max(0,Math.min(1,t));var n=-.5*this._perfomanceIndex+.45;if(this._perfomanceIndex>1){this._desiredQuality+=.1}else{this._desiredQuality-=n}this._desiredQuality=Math.max(0,Math.min(1,this._desiredQuality));var r=Math.max(t,this._desiredQuality);this._desiredQuality=(this._desiredQuality+r)/2;if(this._desiredQuality<this._quality){this._quality=this._desiredQuality}else{this._quality=(this._desiredQuality+9*this._quality)/10}}},{key:"started",get:function e(){return this._started}},{key:"desiredPerfomance",get:function e(){return this._desiredPerfomance}},{key:"actualPerfomance",get:function e(){return this._actualPerfomance}},{key:"qualityLevel",get:function e(){return this._quality}}]);return e}();t.default=i},function(e,t,n){"use strict";var r=n(16);var i=n(18);var o=n(19);var a=n(20);var s=n(21);var u=n(22);var l=n(23);l.alea=r;l.xor128=i;l.xorwow=o;l.xorshift7=a;l.xor4096=s;l.tychei=u;e.exports=l},function(e,t,n){var r;(function(e){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,o,a){function s(e){var t=this,n=f();t.next=function(){var e=2091639*t.s0+t.c*2.3283064365386963e-10;t.s0=t.s1;t.s1=t.s2;return t.s2=e-(t.c=e|0)};t.c=1;t.s0=n(" ");t.s1=n(" ");t.s2=n(" ");t.s0-=n(e);if(t.s0<0){t.s0+=1}t.s1-=n(e);if(t.s1<0){t.s1+=1}t.s2-=n(e);if(t.s2<0){t.s2+=1}n=null}function u(e,t){t.c=e.c;t.s0=e.s0;t.s1=e.s1;t.s2=e.s2;return t}function l(e,t){var n=new s(e),r=t&&t.state,o=n.next;o.int32=function(){return n.next()*4294967296|0};o.double=function(){return o()+(o()*2097152|0)*1.1102230246251565e-16};o.quick=o;if(r){if((typeof r==="undefined"?"undefined":i(r))=="object")u(r,n);o.state=function(){return u(n,{})}}return o}function f(){var e=4022871197;var t=function t(n){n=n.toString();for(var r=0;r<n.length;r++){e+=n.charCodeAt(r);var i=.02519603282416938*e;e=i>>>0;i-=e;i*=e;e=i>>>0;i-=e;e+=i*4294967296}return(e>>>0)*2.3283064365386963e-10};return t}if(o&&o.exports){o.exports=l}else if(n(10)&&n(17)){!(r=function(){return l}.call(t,n,t,o),r!==undefined&&(o.exports=r))}else{this.alea=l}})(undefined,(false?"undefined":i(e))=="object"&&e,n(10))}).call(t,n(9)(e))},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){var r;(function(e){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,o,a){function s(e){var t=this,n="";t.x=0;t.y=0;t.z=0;t.w=0;t.next=function(){var e=t.x^t.x<<11;t.x=t.y;t.y=t.z;t.z=t.w;return t.w^=t.w>>>19^e^e>>>8};if(e===(e|0)){t.x=e}else{n+=e}for(var r=0;r<n.length+64;r++){t.x^=n.charCodeAt(r)|0;t.next()}}function u(e,t){t.x=e.x;t.y=e.y;t.z=e.z;t.w=e.w;return t}function l(e,t){var n=new s(e),r=t&&t.state,o=function e(){return(n.next()>>>0)/4294967296};o.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(r===0);return r};o.int32=n.next;o.quick=o;if(r){if((typeof r==="undefined"?"undefined":i(r))=="object")u(r,n);o.state=function(){return u(n,{})}}return o}if(o&&o.exports){o.exports=l}else if(n(10)&&n(17)){!(r=function(){return l}.call(t,n,t,o),r!==undefined&&(o.exports=r))}else{this.xor128=l}})(undefined,(false?"undefined":i(e))=="object"&&e,n(10))}).call(t,n(9)(e))},function(e,t,n){var r;(function(e){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,o,a){function s(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;t.x=t.y;t.y=t.z;t.z=t.w;t.w=t.v;return(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^(e^e<<1))|0};t.x=0;t.y=0;t.z=0;t.w=0;t.v=0;if(e===(e|0)){t.x=e}else{n+=e}for(var r=0;r<n.length+64;r++){t.x^=n.charCodeAt(r)|0;if(r==n.length){t.d=t.x<<10^t.x>>>4}t.next()}}function u(e,t){t.x=e.x;t.y=e.y;t.z=e.z;t.w=e.w;t.v=e.v;t.d=e.d;return t}function l(e,t){var n=new s(e),r=t&&t.state,o=function e(){return(n.next()>>>0)/4294967296};o.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(r===0);return r};o.int32=n.next;o.quick=o;if(r){if((typeof r==="undefined"?"undefined":i(r))=="object")u(r,n);o.state=function(){return u(n,{})}}return o}if(o&&o.exports){o.exports=l}else if(n(10)&&n(17)){!(r=function(){return l}.call(t,n,t,o),r!==undefined&&(o.exports=r))}else{this.xorwow=l}})(undefined,(false?"undefined":i(e))=="object"&&e,n(10))}).call(t,n(9)(e))},function(e,t,n){var r;(function(e){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,i,o){function a(e){var t=this;t.next=function(){var e=t.x,n=t.i,r,i,o;r=e[n];r^=r>>>7;i=r^r<<24;r=e[n+1&7];i^=r^r>>>10;r=e[n+3&7];i^=r^r>>>3;r=e[n+4&7];i^=r^r<<7;r=e[n+7&7];r=r^r<<13;i^=r^r<<9;e[n]=i;t.i=n+1&7;return i};function n(e,t){var n,r,i=[];if(t===(t|0)){r=i[0]=t}else{t=""+t;for(n=0;n<t.length;++n){i[n&7]=i[n&7]<<15^t.charCodeAt(n)+i[n+1&7]<<13}}while(i.length<8){i.push(0)}for(n=0;n<8&&i[n]===0;++n){}if(n==8)r=i[7]=-1;else r=i[n];e.x=i;e.i=0;for(n=256;n>0;--n){e.next()}}n(t,e)}function s(e,t){t.x=e.x.slice();t.i=e.i;return t}function u(e,t){if(e==null)e=+new Date;var n=new a(e),r=t&&t.state,i=function e(){return(n.next()>>>0)/4294967296};i.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(r===0);return r};i.int32=n.next;i.quick=i;if(r){if(r.x)s(r,n);i.state=function(){return s(n,{})}}return i}if(i&&i.exports){i.exports=u}else if(n(10)&&n(17)){!(r=function(){return u}.call(t,n,t,i),r!==undefined&&(i.exports=r))}else{this.xorshift7=u}})(undefined,(false?"undefined":i(e))=="object"&&e,n(10))}).call(t,n(9)(e))},function(e,t,n){var r;(function(e){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,i,o){function a(e){var t=this;t.next=function(){var e=t.w,n=t.X,r=t.i,i,o;t.w=e=e+1640531527|0;o=n[r+34&127];i=n[r=r+1&127];o^=o<<13;i^=i<<17;o^=o>>>15;i^=i>>>12;o=n[r]=o^i;t.i=r;return o+(e^e>>>16)|0};function n(e,t){var n,r,i,o,a,s=[],u=128;if(t===(t|0)){r=t;t=null}else{t=t+"\0";r=0;u=Math.max(u,t.length)}for(i=0,o=-32;o<u;++o){if(t)r^=t.charCodeAt((o+32)%t.length);if(o===0)a=r;r^=r<<10;r^=r>>>15;r^=r<<4;r^=r>>>13;if(o>=0){a=a+1640531527|0;n=s[o&127]^=r+a;i=0==n?i+1:0}}if(i>=128){s[(t&&t.length||0)&127]=-1}i=127;for(o=4*128;o>0;--o){r=s[i+34&127];n=s[i=i+1&127];r^=r<<13;n^=n<<17;r^=r>>>15;n^=n>>>12;s[i]=r^n}e.w=a;e.X=s;e.i=i}n(t,e)}function s(e,t){t.i=e.i;t.w=e.w;t.X=e.X.slice();return t}function u(e,t){if(e==null)e=+new Date;var n=new a(e),r=t&&t.state,i=function e(){return(n.next()>>>0)/4294967296};i.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(r===0);return r};i.int32=n.next;i.quick=i;if(r){if(r.X)s(r,n);i.state=function(){return s(n,{})}}return i}if(i&&i.exports){i.exports=u}else if(n(10)&&n(17)){!(r=function(){return u}.call(t,n,t,i),r!==undefined&&(i.exports=r))}else{this.xor4096=u}})(undefined,(false?"undefined":i(e))=="object"&&e,n(10))}).call(t,n(9)(e))},function(e,t,n){var r;(function(e){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(e,o,a){function s(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;e=e<<25^e>>>7^n;n=n-r|0;r=r<<24^r>>>8^i;i=i-e|0;t.b=e=e<<20^e>>>12^n;t.c=n=n-r|0;t.d=r<<16^n>>>16^i;return t.a=i-e|0};t.a=0;t.b=0;t.c=2654435769|0;t.d=1367130551;if(e===Math.floor(e)){t.a=e/4294967296|0;t.b=e|0}else{n+=e}for(var r=0;r<n.length+20;r++){t.b^=n.charCodeAt(r)|0;t.next()}}function u(e,t){t.a=e.a;t.b=e.b;t.c=e.c;t.d=e.d;return t}function l(e,t){var n=new s(e),r=t&&t.state,o=function e(){return(n.next()>>>0)/4294967296};o.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(r===0);return r};o.int32=n.next;o.quick=o;if(r){if((typeof r==="undefined"?"undefined":i(r))=="object")u(r,n);o.state=function(){return u(n,{})}}return o}if(o&&o.exports){o.exports=l}else if(n(10)&&n(17)){!(r=function(){return l}.call(t,n,t,o),r!==undefined&&(o.exports=r))}else{this.tychei=l}})(undefined,(false?"undefined":i(e))=="object"&&e,n(10))}).call(t,n(9)(e))},function(e,t,n){var r;(function(e){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(o,a){var s=this,u=256,l=6,f=52,c="random",h=a.pow(u,l),d=a.pow(2,f),p=d*2,_=u-1,y;function v(e,t,n){var r=[];t=t==true?{entropy:true}:t||{};var i=k(g(t.entropy?[e,O(o)]:e==null?w():e,3),r);var s=new m(r);var f=function e(){var t=s.g(l),n=h,r=0;while(t<d){t=(t+r)*u;n*=u;r=s.g(1)}while(t>=p){t/=2;n/=2;r>>>=1}return(t+r)/n};f.int32=function(){return s.g(4)|0};f.quick=function(){return s.g(4)/4294967296};f.double=f;k(O(s.S),o);return(t.pass||n||function(e,t,n,r){if(r){if(r.S){b(r,s)}e.state=function(){return b(s,{})}}if(n){a[c]=e;return t}else return e})(f,i,"global"in t?t.global:this==a,t.state)}a["seed"+c]=v;function m(e){var t,n=e.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];if(!n){e=[n++]}while(i<u){a[i]=i++}for(i=0;i<u;i++){a[i]=a[o=_&o+e[i%n]+(t=a[i])];a[o]=t}(r.g=function(e){var t,n=0,i=r.i,o=r.j,a=r.S;while(e--){t=a[i=_&i+1];n=n*u+a[_&(a[i]=a[o=_&o+t])+(a[o]=t)]}r.i=i;r.j=o;return n})(u)}function b(e,t){t.i=e.i;t.j=e.j;t.S=e.S.slice();return t}function g(e,t){var n=[],r=typeof e==="undefined"?"undefined":i(e),o;if(t&&r=="object"){for(o in e){try{n.push(g(e[o],t-1))}catch(e){}}}return n.length?n:r=="string"?e:e+"\0"}function k(e,t){var n=e+"",r,i=0;while(i<n.length){t[_&i]=_&(r^=t[_&i]*19)+n.charCodeAt(i++)}return O(t)}function w(){try{var e;if(y&&(e=y.randomBytes)){e=e(u)}else{e=new Uint8Array(u);(s.crypto||s.msCrypto).getRandomValues(e)}return O(e)}catch(e){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,O(o)]}}function O(e){return String.fromCharCode.apply(0,e)}k(a.random(),o);if((false?"undefined":i(e))=="object"&&e.exports){e.exports=v;try{y=n(24)}catch(e){}}else if(true){!(r=function(){return v}.call(t,n,t,e),r!==undefined&&(e.exports=r))}})([],Math)}).call(t,n(9)(e))},function(e,t){},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(){r(this,e)}n(e,[{key:"initBatlefield",value:function e(t){}},{key:"preRender",value:function e(){}},{key:"postRender",value:function e(){}},{key:"renderTank",value:function e(t,n){}},{key:"renderClock",value:function e(t,n){}},{key:"renderTankStats",value:function e(t){}},{key:"renderBullet",value:function e(t,n){}},{key:"setSpeed",value:function e(t){}},{key:"stop",value:function e(){}},{key:"quality",get:function e(){return 1},set:function e(t){}}]);return e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(27);var a=_(o);var s=n(41);var u=_(s);var l=n(42);var f=_(l);var c=n(43);var h=_(c);var d=n(45);var p=_(d);function _(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var b=function(e){m(t,e);function t(){y(this,t);var e=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._frameCounter=0;e._fpsLabel=null;e._scoreBoard=null;return e}r(t,[{key:"initBatlefield",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initBatlefield",this).call(this,n);var r=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:"#00ff00"});this._fpsLabel=new PIXI.Text("FPS",r);this._fpsLabel.x=100;this._fpsLabel.y=5;this.stage.addChild(this._fpsLabel);var o=this;setInterval(function(){o._fpsLabel.text="FPS: "+o._frameCounter;o._frameCounter=0},1e3);r=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:"#00ff00"});this._scoreBoard=new PIXI.Text("scores",r);this._scoreBoard.x=n.margin+2;this._scoreBoard.y=n.margin+2;this._scoreBoard.alpha=.5;this.stage.addChild(this._scoreBoard)}},{key:"renderTankStats",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderTankStats",this).call(this,n);var r=[];var o=void 0;for(o=0;o<n.length;o++){r.push({name:n[o].fullName,energy:n[o].energy,value:n[o].score})}r.sort(function(e,t){if(e.value<t.value)return 1;if(e.value>t.value)return-1;return 0});var a="";for(o=0;o<r.length;o++){a+=r[o].value.toFixed(3)+" - "+r[o].name+(r[o].energy==0?" [X]":"")+"\n"}this._scoreBoard.text=a}},{key:"postRender",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"postRender",this).call(this);this._frameCounter++}},{key:"_createBattlefieldView",value:function e(t){return new u.default(t)}},{key:"_createClockView",value:function e(t){return new f.default(t)}},{key:"_createBulletView",value:function e(t){return new h.default(t)}},{key:"_createTankView",value:function e(t){return new p.default(t)}}]);return t}(a.default);t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(28);var a=_(o);var s=n(30);var u=_(s);var l=n(31);var f=_(l);var c=n(32);var h=_(c);var d=n(33);var p=_(d);function _(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var b=function(e){m(t,e);function t(e){y(this,t);var n=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n._name=e;if(typeof PIXI==="undefined"){throw"Pixi.js is required!"}n._masterContainer=new PIXI.Container;n._tankContainer=new PIXI.Container;n._bulletContainer=new PIXI.Container;n._hudContainer=new PIXI.Container;n._masterContainer.addChild(n._tankContainer);n._masterContainer.addChild(n._bulletContainer);n._masterContainer.addChild(n._hudContainer);n._renderer=null;n._stage=null;n._clockModel=new h.default;n._clockView=null;n._battlefieldView=null;if(window.devicePixelRatio>=2){n._rendererScale=2}else{n._rendererScale=1}return n}r(t,[{key:"initBatlefield",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initBatlefield",this).call(this,n);this._masterContainer.x=-this.offsetX;this._masterContainer.y=-this.offsetY;var r={view:this._canvas,antialias:false,backgroundColor:16777215,resolution:window.devicePixelRatio};this._renderer=new PIXI.autoDetectRenderer(n.width+2*n.margin,n.height+2*n.margin,r);this._stage=new PIXI.Container;this._battlefieldView=this._createBattlefieldView(n);this._clockView=this._createClockView(this._clockModel);this._stage.addChild(this._battlefieldView.view);this._stage.addChild(this._masterContainer);this._stage.addChild(this._clockView.view);this._renderer.render(this._stage)}},{key:"init",value:function e(t){this._canvas=t}},{key:"loadAssets",value:function e(t){if(!this._name){t();return}var n=new PIXI.loaders.Loader;n.after((0,p.default)(PIXI));var r=this._rendererScale==2?"retina":"web";n.add("img/game_"+this._name+"_"+r+".json");var i=this;n.load(function(){i.onAssetsLoaded();t()})}},{key:"onAssetsLoaded",value:function e(){}},{key:"preRender",value:function e(){this._battlefieldView.update()}},{key:"renderTank",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderTank",this).call(this,n,r);var o=this.getTankView(n.id);if(!o.parent&&o.isAlive){this._tankContainer.addChild(o.view);this._hudContainer.addChild(o.hudView)}}},{key:"renderBullet",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderBullet",this).call(this,n,r);var o=this.getBulletView(n.id);if(!o.parent&&o.isAlive){this._bulletContainer.addChild(o.view)}}},{key:"renderClock",value:function e(t,n){this._clockModel.update(t,n);this._clockView.update()}},{key:"postRender",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"postRender",this).call(this);this._renderer.render(this._stage)}},{key:"_createTankView",value:function e(t){return new f.default(t)}},{key:"_createBulletView",value:function e(t){return new u.default(t)}},{key:"_createBattlefieldView",value:function e(t){return new u.default(t)}},{key:"_createClockView",value:function e(t){return new u.default(t)}},{key:"stage",get:function e(){return this._stage}},{key:"battlefieldView",get:function e(){return this._battlefieldView}},{key:"masterContainer",get:function e(){return this._masterContainer}}]);return t}(a.default);t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(25);var o=u(i);var a=n(29);var s=u(a);function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){c(t,e);function t(){l(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._tankMap=[];e._bulletMap=[];e._offsetX=0;e._offsetY=0;e._speedMultiplier=1;return e}r(t,[{key:"initBatlefield",value:function e(t){this._offsetX=t.offsetX;this._offsetY=t.offsetY}},{key:"renderTank",value:function e(t,n){this._renderModel(t,n,this._tankMap,this._createTankView)}},{key:"renderBullet",value:function e(t,n){this._renderModel(t,n,this._bulletMap,this._createBulletView)}},{key:"getBulletView",value:function e(t){return this._bulletMap[t]}},{key:"getTankView",value:function e(t){return this._tankMap[t]}},{key:"setSpeed",value:function e(t){this._speedMultiplier=t}},{key:"_renderModel",value:function e(t,n,r,i){var o=null;if(r[t.id]){o=r[t.id]}else{o=i(t);r[t.id]=o}o.update(n);return o}},{key:"_createTankView",value:function e(t){return new s.default(t)}},{key:"_createBulletView",value:function e(t){return new s.default(t)}},{key:"offsetX",get:function e(){return this._offsetX}},{key:"offsetY",get:function e(){return this._offsetY}},{key:"speedMultiplier",get:function e(){return this._speedMultiplier}}]);return t}(o.default);t.default=h},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t){r(this,e);this._model=t;this._view=null;this._isAlive=true}n(e,[{key:"destroy",value:function e(){this._isAlive=false}},{key:"update",value:function e(t){}},{key:"isAlive",get:function e(){return this._isAlive}},{key:"model",get:function e(){return this._model}},{key:"view",get:function e(){return this._view}}]);return e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(29);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){f(t,e);function t(e){u(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n._model=e;n._view=new PIXI.Container;n._create(n._view);return n}r(t,[{key:"update",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,n);if(this._model.x!==undefined){this._view.x=this._model.x}if(this._model.y!==undefined){this._view.y=this._model.y}if(this._model.angle!==undefined){this._view.rotation=this._model.angle*(Math.PI/180)}}},{key:"destroy",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this);if(this.view.parent){this.view.parent.removeChild(this.view)}}},{key:"_create",value:function e(t){}}]);return t}(a.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(30);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){f(t,e);function t(e){u(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n._hudView=new PIXI.Container;n._createHud(n._hudView);return n}r(t,[{key:"update",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,n);this.view.rotation=0;this.body.rotation=this.model.angle*(Math.PI/180);this.gun.rotation=(this.model.angle+this.model.gunAngle)*(Math.PI/180);this.radar.rotation=(this.model.angle+this.model.radarAngle)*(Math.PI/180);this.energyBar.scale.x=this.model.energy/this.model.maxEnergy;this.label.text=this.model.fullName;this.hudView.x=this.view.x;this.hudView.y=this.view.y;for(var r=0;r<n.length;r++){this._onEvent(n[r])}}},{key:"_onEvent",value:function e(t){switch(t.type){case"shoot":this._onShoot(t);break;case"destroy":this._onDestroy(t);break}}},{key:"_onShoot",value:function e(t){}},{key:"_onDestroy",value:function e(t){this.destroy()}},{key:"_create",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_create",this).call(this,n);this._body=this._createBody();this._gun=this._createGun();this._radar=this._createRadar();n.addChild(this._body);n.addChild(this._gun);n.addChild(this._radar)}},{key:"_createHud",value:function e(t){this._label=this._createLabel();this._energyBar=this._createEnergyBar();t.addChild(this._createHudBackground());t.addChild(this._energyBar);t.addChild(this._label)}},{key:"_createBody",value:function e(){return new PIXI.Sprite}},{key:"_createGun",value:function e(){return new PIXI.Sprite}},{key:"_createRadar",value:function e(){return new PIXI.Sprite}},{key:"_createHudBackground",value:function e(){return new PIXI.Sprite}},{key:"_createEnergyBar",value:function e(){return new PIXI.Sprite}},{key:"_createLabel",value:function e(){return new PIXI.Text}},{key:"destroy",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this);if(this.hudView.parent){this.hudView.parent.removeChild(this.hudView)}}},{key:"body",get:function e(){return this._body}},{key:"hudView",get:function e(){return this._hudView}},{key:"gun",get:function e(){return this._gun}},{key:"radar",get:function e(){return this._radar}},{key:"label",get:function e(){return this._label}},{key:"energyBar",get:function e(){return this._energyBar}}]);return t}(a.default);t.default=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(){r(this,e)}n(e,[{key:"construct",value:function e(){this._msElapsed=0;this._msLimit=0}},{key:"update",value:function e(t,n){this._msElapsed=t;this._msLimit=n}},{key:"msElapsed",get:function e(){return this._msElapsed}},{key:"msLimit",get:function e(){return this._msLimit}},{key:"text",get:function e(){var t=Math.max(0,this._msLimit-this._msElapsed);var n=Math.floor(t/1e3);var r=t%1e3;n=n.toString();while(n.length<2){n="0"+n}r=r.toString();while(r.length<3){r="0"+r}return"0:"+n+"."+r}}]);return e}();t.default=i},function(e,t,n){"use strict";var r=n(34).Resource;function i(e){var t=e.split("/");t.pop();return t.join("/")}function o(e,t){var n=e;this.done=function(){n--;if(n===0){t()}}}e.exports=function(e){return function(t,n){if(!t.data||t.type!==r.TYPE.JSON||!t.data.meta||t.data.meta.type!=="pixi-packer"){return n()}if(t.data.meta.version>1){throw new Error("pixi-packer manifest version "+t.data.meta.version+" not supported")}var a=this;var s={crossOrigin:t.crossOrigin,loadType:r.LOAD_TYPE.IMAGE,parentResource:t};var u=t.url.replace(a.baseUrl,"");var l=i(u);var f=t.data.resolution;if(t.data.spritesheets.length&&a.progress===100){a.progress=0}var c=new o(t.data.spritesheets.length,n);t.data.spritesheets.forEach(function(t){var n=t.image;var r=l+"/"+t.image;a.add(n,r,s,function(n){n.texture.baseTexture.resolution=f;n.texture.baseTexture.update();n.textures={};t.sprites.forEach(function(t){var r=new e.Rectangle(t.position.x/f,t.position.y/f,t.dimension.w/f,t.dimension.h/f);var i;if(Number(e.VERSION.charAt(0))>=4){i=new e.Rectangle(0,0,t.dimension.w/f,t.dimension.h/f)}else{i=r.clone()}var o=null;if(t.trim){if(Number(e.VERSION.charAt(0))>=4){o=new e.Rectangle(t.trim.x/f,t.trim.y/f,t.trim.w/f,t.trim.h/f);r.width=t.trim.w/f;r.height=t.trim.h/f}else{o=new e.Rectangle(t.trim.x/f,t.trim.y/f,r.width,r.height);i.width=t.trim.w/f;i.height=t.trim.h/f}}n.textures[t.name]=new e.Texture(n.texture.baseTexture,r,i,o,false);e.utils.TextureCache[t.name]=n.textures[t.name]});c.done()})})}}},function(e,t,n){"use strict";var r=n(35).default;var i=n(39).default;var o=n(38);var a=n(40);r.Resource=i;r.async=o;r.base64=a;e.exports=r;e.exports.default=r},function(e,t,n){"use strict";var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.__esModule=true;var i=typeof Symbol==="function"&&r(Symbol.iterator)==="symbol"?function(e){return typeof e==="undefined"?"undefined":r(e)}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e==="undefined"?"undefined":r(e)};var o=n(36);var a=p(o);var s=n(37);var u=p(s);var l=n(38);var f=d(l);var c=n(39);var h=p(c);function d(e){if(e&&e.__esModule){return e}else{var t={};if(e!=null){for(var n in e){if(Object.prototype.hasOwnProperty.call(e,n))t[n]=e[n]}}t.default=e;return t}}function p(e){return e&&e.__esModule?e:{default:e}}function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var y=100;var v=/(#[\w-]+)?$/;var m=function(){function e(){var t=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;_(this,e);this.baseUrl=n;this.progress=0;this.loading=false;this.defaultQueryString="";this._beforeMiddleware=[];this._afterMiddleware=[];this._resourcesParsing=[];this._boundLoadResource=function(e,n){return t._loadResource(e,n)};this._queue=f.queue(this._boundLoadResource,r);this._queue.pause();this.resources={};this.onProgress=new a.default;this.onError=new a.default;this.onLoad=new a.default;this.onStart=new a.default;this.onComplete=new a.default}e.prototype.add=function e(t,n,r,o){if(Array.isArray(t)){for(var a=0;a<t.length;++a){this.add(t[a])}return this}if((typeof t==="undefined"?"undefined":i(t))==="object"){o=n||t.callback||t.onComplete;r=t;n=t.url;t=t.name||t.key||t.url}if(typeof n!=="string"){o=r;r=n;n=t}if(typeof n!=="string"){throw new Error("No url passed to add resource to loader.")}if(typeof r==="function"){o=r;r=null}if(this.loading&&(!r||!r.parentResource)){throw new Error("Cannot add resources while the loader is running.")}if(this.resources[t]){throw new Error('Resource named "'+t+'" already exists.')}n=this._prepareUrl(n);this.resources[t]=new h.default(t,n,r);if(typeof o==="function"){this.resources[t].onAfterMiddleware.once(o)}if(this.loading){var s=r.parentResource;var u=[];for(var l=0;l<s.children.length;++l){if(!s.children[l].isComplete){u.push(s.children[l])}}var f=s.progressChunk*(u.length+1);var c=f/(u.length+2);s.children.push(this.resources[t]);s.progressChunk=c;for(var d=0;d<u.length;++d){u[d].progressChunk=c}this.resources[t].progressChunk=c}this._queue.push(this.resources[t]);return this};e.prototype.pre=function e(t){this._beforeMiddleware.push(t);return this};e.prototype.use=function e(t){this._afterMiddleware.push(t);return this};e.prototype.reset=function e(){this.progress=0;this.loading=false;this._queue.kill();this._queue.pause();for(var t in this.resources){var n=this.resources[t];if(n._onLoadBinding){n._onLoadBinding.detach()}if(n.isLoading){n.abort()}}this.resources={};return this};e.prototype.load=function e(t){if(typeof t==="function"){this.onComplete.once(t)}if(this.loading){return this}var n=100/this._queue._tasks.length;for(var r=0;r<this._queue._tasks.length;++r){this._queue._tasks[r].data.progressChunk=n}this.loading=true;this.onStart.dispatch(this);this._queue.resume();return this};e.prototype._prepareUrl=function e(t){var n=(0,u.default)(t,{strictMode:true});var r=void 0;if(n.protocol||!n.path||t.indexOf("//")===0){r=t}else if(this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&t.charAt(0)!=="/"){r=this.baseUrl+"/"+t}else{r=this.baseUrl+t}if(this.defaultQueryString){var i=v.exec(r)[0];r=r.substr(0,r.length-i.length);if(r.indexOf("?")!==-1){r+="&"+this.defaultQueryString}else{r+="?"+this.defaultQueryString}r+=i}return r};e.prototype._loadResource=function e(t,n){var r=this;t._dequeue=n;f.eachSeries(this._beforeMiddleware,function(e,n){e.call(r,t,function(){n(t.isComplete?{}:null)})},function(){if(t.isComplete){r._onLoad(t)}else{t._onLoadBinding=t.onComplete.once(r._onLoad,r);t.load()}},true)};e.prototype._onComplete=function e(){this.loading=false;this.onComplete.dispatch(this,this.resources)};e.prototype._onLoad=function e(t){var n=this;t._onLoadBinding=null;this._resourcesParsing.push(t);t._dequeue();f.eachSeries(this._afterMiddleware,function(e,r){e.call(n,t,r)},function(){t.onAfterMiddleware.dispatch(t);n.progress+=t.progressChunk;n.onProgress.dispatch(n,t);if(t.error){n.onError.dispatch(t.error,n,t)}else{n.onLoad.dispatch(n,t)}n._resourcesParsing.splice(n._resourcesParsing.indexOf(t),1);if(n._queue.idle()&&n._resourcesParsing.length===0){n.progress=y;n._onComplete()}},true)};return e}();t.default=m},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t,n,i){if(n===undefined)n=false;r(this,e);this._fn=t;this._once=n;this._thisArg=i;this._next=this._prev=this._owner=null}n(e,[{key:"detach",value:function e(){if(this._owner===null)return false;this._owner.detach(this);return true}}]);return e}();function o(e,t){if(!e._head){e._head=t;e._tail=t}else{e._tail._next=t;t._prev=e._tail;e._tail=t}t._owner=e;return t}var a=function(){function e(){r(this,e);this._head=this._tail=undefined}n(e,[{key:"handlers",value:function e(){var t=arguments.length<=0||arguments[0]===undefined?false:arguments[0];var n=this._head;if(t)return!!n;var r=[];while(n){r.push(n);n=n._next}return r}},{key:"has",value:function e(t){if(!(t instanceof i)){throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.")}return t._owner===this}},{key:"dispatch",value:function e(){var t=this._head;if(!t)return false;while(t){if(t._once)this.detach(t);t._fn.apply(t._thisArg,arguments);t=t._next}return true}},{key:"add",value:function e(t){var n=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(typeof t!=="function"){throw new Error("MiniSignal#add(): First arg must be a Function.")}return o(this,new i(t,false,n))}},{key:"once",value:function e(t){var n=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(typeof t!=="function"){throw new Error("MiniSignal#once(): First arg must be a Function.")}return o(this,new i(t,true,n))}},{key:"detach",value:function e(t){if(!(t instanceof i)){throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.")}if(t._owner!==this)return this;if(t._prev)t._prev._next=t._next;if(t._next)t._next._prev=t._prev;if(t===this._head){this._head=t._next;if(t._next===null){this._tail=null}}else if(t===this._tail){this._tail=t._prev;this._tail._next=null}t._owner=null;return this}},{key:"detachAll",value:function e(){var t=this._head;if(!t)return this;this._head=this._tail=null;while(t){t._owner=null;t=t._next}return this}}]);return e}();a.MiniSignalBinding=i;t["default"]=a;e.exports=t["default"]},function(e,t){"use strict";e.exports=function e(t,n){n=n||{};var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var i=r.parser[n.strictMode?"strict":"loose"].exec(t);var o={};var a=14;while(a--){o[r.key[a]]=i[a]||""}o[r.q.name]={};o[r.key[12]].replace(r.q.parser,function(e,t,n){if(t)o[r.q.name][t]=n});return o}},function(e,t){"use strict";t.__esModule=true;t.eachSeries=r;t.queue=o;function n(){}function r(e,t,n,r){var i=0;var o=e.length;(function a(s){if(s||i===o){if(n){n(s)}return}if(r){setTimeout(function(){t(e[i++],a)},1)}else{t(e[i++],a)}})()}function i(e){return function t(){if(e===null){throw new Error("Callback was already called.")}var n=e;e=null;n.apply(this,arguments)}}function o(e,t){if(t==null){t=1}else if(t===0){throw new Error("Concurrency must not be zero")}var r=0;var o={_tasks:[],concurrency:t,saturated:n,unsaturated:n,buffer:t/4,empty:n,drain:n,error:n,started:false,paused:false,push:function e(t,n){a(t,false,n)},kill:function e(){r=0;o.drain=n;o.started=false;o._tasks=[]},unshift:function e(t,n){a(t,true,n)},process:function t(){while(!o.paused&&r<o.concurrency&&o._tasks.length){var n=o._tasks.shift();if(o._tasks.length===0){o.empty()}r+=1;if(r===o.concurrency){o.saturated()}e(n.data,i(s(n)))}},length:function e(){return o._tasks.length},running:function e(){return r},idle:function e(){return o._tasks.length+r===0},pause:function e(){if(o.paused===true){return}o.paused=true},resume:function e(){if(o.paused===false){return}o.paused=false;for(var t=1;t<=o.concurrency;t++){o.process()}}};function a(e,t,r){if(r!=null&&typeof r!=="function"){throw new Error("task callback must be a function")}o.started=true;if(e==null&&o.idle()){setTimeout(function(){return o.drain()},1);return}var i={data:e,callback:typeof r==="function"?r:n};if(t){o._tasks.unshift(i)}else{o._tasks.push(i)}setTimeout(function(){return o.process()},1)}function s(e){return function t(){r-=1;e.callback.apply(e,arguments);if(arguments[0]!=null){o.error(arguments[0],e.data)}if(r<=o.concurrency-o.buffer){o.unsaturated()}if(o.idle()){o.drain()}o.process()}}return o}},function(e,t,n){"use strict";t.__esModule=true;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(37);var o=u(i);var a=n(36);var s=u(a);function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var f=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest));var c=null;var h=0;var d=200;var p=204;var _=1223;var y=2;function v(){}var m=function(){e.setExtensionLoadType=function t(n,r){b(e._loadTypeMap,n,r)};e.setExtensionXhrType=function t(n,r){b(e._xhrTypeMap,n,r)};function e(t,n,r){l(this,e);if(typeof t!=="string"||typeof n!=="string"){throw new Error("Both name and url are required for constructing a resource.")}r=r||{};this._flags=0;this._setFlag(e.STATUS_FLAGS.DATA_URL,n.indexOf("data:")===0);this.name=t;this.url=n;this.extension=this._getExtension();this.data=null;this.crossOrigin=r.crossOrigin===true?"anonymous":r.crossOrigin;this.loadType=r.loadType||this._determineLoadType();this.xhrType=r.xhrType;this.metadata=r.metadata||{};this.error=null;this.xhr=null;this.children=[];this.type=e.TYPE.UNKNOWN;this.progressChunk=0;this._dequeue=v;this._onLoadBinding=null;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this);this.onStart=new s.default;this.onProgress=new s.default;this.onComplete=new s.default;this.onAfterMiddleware=new s.default}e.prototype.complete=function t(){if(this.data&&this.data.removeEventListener){this.data.removeEventListener("error",this._boundOnError,false);this.data.removeEventListener("load",this._boundComplete,false);this.data.removeEventListener("progress",this._boundOnProgress,false);this.data.removeEventListener("canplaythrough",this._boundComplete,false)}if(this.xhr){if(this.xhr.removeEventListener){this.xhr.removeEventListener("error",this._boundXhrOnError,false);this.xhr.removeEventListener("abort",this._boundXhrOnAbort,false);this.xhr.removeEventListener("progress",this._boundOnProgress,false);this.xhr.removeEventListener("load",this._boundXhrOnLoad,false)}else{this.xhr.onerror=null;this.xhr.ontimeout=null;this.xhr.onprogress=null;this.xhr.onload=null}}if(this.isComplete){throw new Error("Complete called again for an already completed resource.")}this._setFlag(e.STATUS_FLAGS.COMPLETE,true);this._setFlag(e.STATUS_FLAGS.LOADING,false);this.onComplete.dispatch(this)};e.prototype.abort=function t(n){if(this.error){return}this.error=new Error(n);if(this.xhr){this.xhr.abort()}else if(this.xdr){this.xdr.abort()}else if(this.data){if(this.data.src){this.data.src=e.EMPTY_GIF}else{while(this.data.firstChild){this.data.removeChild(this.data.firstChild)}}}this.complete()};e.prototype.load=function t(n){var r=this;if(this.isLoading){return}if(this.isComplete){if(n){setTimeout(function(){return n(r)},1)}return}else if(n){this.onComplete.once(n)}this._setFlag(e.STATUS_FLAGS.LOADING,true);this.onStart.dispatch(this);if(this.crossOrigin===false||typeof this.crossOrigin!=="string"){this.crossOrigin=this._determineCrossOrigin(this.url)}switch(this.loadType){case e.LOAD_TYPE.IMAGE:this.type=e.TYPE.IMAGE;this._loadElement("image");break;case e.LOAD_TYPE.AUDIO:this.type=e.TYPE.AUDIO;this._loadSourceElement("audio");break;case e.LOAD_TYPE.VIDEO:this.type=e.TYPE.VIDEO;this._loadSourceElement("video");break;case e.LOAD_TYPE.XHR:default:if(f&&this.crossOrigin){this._loadXdr()}else{this._loadXhr()}break}};e.prototype._hasFlag=function e(t){return!!(this._flags&t)};e.prototype._setFlag=function e(t,n){this._flags=n?this._flags|t:this._flags&~t};e.prototype._loadElement=function e(t){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(t==="image"&&typeof window.Image!=="undefined"){this.data=new Image}else{this.data=document.createElement(t)}if(this.crossOrigin){this.data.crossOrigin=this.crossOrigin}if(!this.metadata.skipSource){this.data.src=this.url}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false)};e.prototype._loadSourceElement=function e(t){if(this.metadata.loadElement){this.data=this.metadata.loadElement}else if(t==="audio"&&typeof window.Audio!=="undefined"){this.data=new Audio}else{this.data=document.createElement(t)}if(this.data===null){this.abort("Unsupported element: "+t);return}if(!this.metadata.skipSource){if(navigator.isCocoonJS){this.data.src=Array.isArray(this.url)?this.url[0]:this.url}else if(Array.isArray(this.url)){var n=this.metadata.mimeType;for(var r=0;r<this.url.length;++r){this.data.appendChild(this._createSource(t,this.url[r],Array.isArray(n)?n[r]:n))}}else{var i=this.metadata.mimeType;this.data.appendChild(this._createSource(t,this.url,Array.isArray(i)?i[0]:i))}}this.data.addEventListener("error",this._boundOnError,false);this.data.addEventListener("load",this._boundComplete,false);this.data.addEventListener("progress",this._boundOnProgress,false);this.data.addEventListener("canplaythrough",this._boundComplete,false);this.data.load()};e.prototype._loadXhr=function t(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var n=this.xhr=new XMLHttpRequest;n.open("GET",this.url,true);if(this.xhrType===e.XHR_RESPONSE_TYPE.JSON||this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT){n.responseType=e.XHR_RESPONSE_TYPE.TEXT}else{n.responseType=this.xhrType}n.addEventListener("error",this._boundXhrOnError,false);n.addEventListener("abort",this._boundXhrOnAbort,false);n.addEventListener("progress",this._boundOnProgress,false);n.addEventListener("load",this._boundXhrOnLoad,false);n.send()};e.prototype._loadXdr=function e(){if(typeof this.xhrType!=="string"){this.xhrType=this._determineXhrType()}var t=this.xhr=new XDomainRequest;t.timeout=5e3;t.onerror=this._boundXhrOnError;t.ontimeout=this._boundXdrOnTimeout;t.onprogress=this._boundOnProgress;t.onload=this._boundXhrOnLoad;t.open("GET",this.url,true);setTimeout(function(){return t.send()},1)};e.prototype._createSource=function e(t,n,r){if(!r){r=t+"/"+this._getExtension(n)}var i=document.createElement("source");i.src=n;i.type=r;return i};e.prototype._onError=function e(t){this.abort("Failed to load element using: "+t.target.nodeName)};e.prototype._onProgress=function e(t){if(t&&t.lengthComputable){this.onProgress.dispatch(this,t.loaded/t.total)}};e.prototype._xhrOnError=function e(){var t=this.xhr;this.abort(g(t)+" Request failed. Status: "+t.status+', text: "'+t.statusText+'"')};e.prototype._xhrOnAbort=function e(){this.abort(g(this.xhr)+" Request was aborted by the user.")};e.prototype._xdrOnTimeout=function e(){this.abort(g(this.xhr)+" Request timed out.")};e.prototype._xhrOnLoad=function t(){var n=this.xhr;var r="";var i=typeof n.status==="undefined"?d:n.status;if(n.responseType===""||n.responseType==="text"||typeof n.responseType==="undefined"){r=n.responseText}if(i===h&&r.length>0){i=d}else if(i===_){i=p}var o=i/100|0;if(o===y){if(this.xhrType===e.XHR_RESPONSE_TYPE.TEXT){this.data=r;this.type=e.TYPE.TEXT}else if(this.xhrType===e.XHR_RESPONSE_TYPE.JSON){try{this.data=JSON.parse(r);this.type=e.TYPE.JSON}catch(e){this.abort("Error trying to parse loaded json: "+e);return}}else if(this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT){try{if(window.DOMParser){var a=new DOMParser;this.data=a.parseFromString(r,"text/xml")}else{var s=document.createElement("div");s.innerHTML=r;this.data=s}this.type=e.TYPE.XML}catch(e){this.abort("Error trying to parse loaded xml: "+e);return}}else{this.data=n.response||r}}else{this.abort("["+n.status+"] "+n.statusText+": "+n.responseURL);return}this.complete()};e.prototype._determineCrossOrigin=function e(t,n){if(t.indexOf("data:")===0){return""}n=n||window.location;if(!c){c=document.createElement("a")}c.href=t;t=(0,o.default)(c.href,{strictMode:true});var r=!t.port&&n.port===""||t.port===n.port;var i=t.protocol?t.protocol+":":"";if(t.host!==n.hostname||!r||i!==n.protocol){return"anonymous"}return""};e.prototype._determineXhrType=function t(){return e._xhrTypeMap[this.extension]||e.XHR_RESPONSE_TYPE.TEXT};e.prototype._determineLoadType=function t(){return e._loadTypeMap[this.extension]||e.LOAD_TYPE.XHR};e.prototype._getExtension=function e(){var t=this.url;var n="";if(this.isDataUrl){var r=t.indexOf("/");n=t.substring(r+1,t.indexOf(";",r))}else{var i=t.indexOf("?");var o=t.indexOf("#");var a=Math.min(i>-1?i:t.length,o>-1?o:t.length);t=t.substring(0,a);n=t.substring(t.lastIndexOf(".")+1)}return n.toLowerCase()};e.prototype._getMimeFromXhrType=function t(n){switch(n){case e.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case e.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case e.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case e.XHR_RESPONSE_TYPE.JSON:return"application/json";case e.XHR_RESPONSE_TYPE.DEFAULT:case e.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}};r(e,[{key:"isDataUrl",get:function t(){return this._hasFlag(e.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function t(){return this._hasFlag(e.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function t(){return this._hasFlag(e.STATUS_FLAGS.LOADING)}}]);return e}();t.default=m;m.STATUS_FLAGS={NONE:0,DATA_URL:1<<0,COMPLETE:1<<1,LOADING:1<<2};m.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};m.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};m.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};m._loadTypeMap={gif:m.LOAD_TYPE.IMAGE,png:m.LOAD_TYPE.IMAGE,bmp:m.LOAD_TYPE.IMAGE,jpg:m.LOAD_TYPE.IMAGE,jpeg:m.LOAD_TYPE.IMAGE,tif:m.LOAD_TYPE.IMAGE,tiff:m.LOAD_TYPE.IMAGE,webp:m.LOAD_TYPE.IMAGE,tga:m.LOAD_TYPE.IMAGE,svg:m.LOAD_TYPE.IMAGE,"svg+xml":m.LOAD_TYPE.IMAGE,mp3:m.LOAD_TYPE.AUDIO,ogg:m.LOAD_TYPE.AUDIO,wav:m.LOAD_TYPE.AUDIO,mp4:m.LOAD_TYPE.VIDEO,webm:m.LOAD_TYPE.VIDEO};m._xhrTypeMap={xhtml:m.XHR_RESPONSE_TYPE.DOCUMENT,html:m.XHR_RESPONSE_TYPE.DOCUMENT,htm:m.XHR_RESPONSE_TYPE.DOCUMENT,xml:m.XHR_RESPONSE_TYPE.DOCUMENT,tmx:m.XHR_RESPONSE_TYPE.DOCUMENT,svg:m.XHR_RESPONSE_TYPE.DOCUMENT,tsx:m.XHR_RESPONSE_TYPE.DOCUMENT,gif:m.XHR_RESPONSE_TYPE.BLOB,png:m.XHR_RESPONSE_TYPE.BLOB,bmp:m.XHR_RESPONSE_TYPE.BLOB,jpg:m.XHR_RESPONSE_TYPE.BLOB,jpeg:m.XHR_RESPONSE_TYPE.BLOB,tif:m.XHR_RESPONSE_TYPE.BLOB,tiff:m.XHR_RESPONSE_TYPE.BLOB,webp:m.XHR_RESPONSE_TYPE.BLOB,tga:m.XHR_RESPONSE_TYPE.BLOB,json:m.XHR_RESPONSE_TYPE.JSON,text:m.XHR_RESPONSE_TYPE.TEXT,txt:m.XHR_RESPONSE_TYPE.TEXT,ttf:m.XHR_RESPONSE_TYPE.BUFFER,otf:m.XHR_RESPONSE_TYPE.BUFFER};m.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function b(e,t,n){if(t&&t.indexOf(".")===0){t=t.substring(1)}if(!t){return}e[t]=n}function g(e){return e.toString().replace("object ","")}},function(e,t){"use strict";t.__esModule=true;t.encodeBinary=r;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(e){var t="";var r=0;while(r<e.length){var i=[0,0,0];var o=[0,0,0,0];for(var a=0;a<i.length;++a){if(r<e.length){i[a]=e.charCodeAt(r++)&255}else{i[a]=0}}o[0]=i[0]>>2;o[1]=(i[0]&3)<<4|i[1]>>4;o[2]=(i[1]&15)<<2|i[2]>>6;o[3]=i[2]&63;var s=r-(e.length-1);switch(s){case 2:o[3]=64;o[2]=64;break;case 1:o[3]=64;break;default:break}for(var u=0;u<o.length;++u){t+=n.charAt(o[u])}}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(30);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}r(t,[{key:"_create",value:function e(t){var n=new PIXI.Graphics;n.beginFill(0);n.lineStyle(1,16776960,.8);n.drawRect(0,0,this.model.width+2*this.model.margin,this.model.height+2*this.model.margin);n.endFill();t.addChild(n);n=new PIXI.Graphics;n.beginFill(0);n.lineStyle(1,16776960,.8);n.drawRect(this.model.margin,this.model.margin,this.model.width,this.model.height);n.endFill();t.addChild(n)}},{key:"update",value:function e(t){}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(30);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(e){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"_create",value:function e(t){var n=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:"#00ff00"});this._label=new PIXI.Text("clock",n);this._label.x=5;this._label.y=5;t.addChild(this._label)}},{key:"update",value:function e(t){this._label.text=this.model.text}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(44);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(e){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"_create",value:function e(t){var n=new PIXI.Graphics;n.beginFill(65280,.5);n.drawCircle(0,0,5);n.endFill();t.addChild(n)}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(30);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){f(t,e);function t(e){u(this,t);return l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"update",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,n);this.view.scale.x=this.view.scale.y=this.model.power*.7+.3;if(this.model.exploded){this.destroy()}}}]);return t}(a.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(31);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(e){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"_createBody",value:function e(){var t=new PIXI.Graphics;t.lineStyle(1,16776960,.8);t.beginFill(65280,.5);t.drawRect(-15,-15,30,30);t.endFill();return t}},{key:"_createGun",value:function e(){var t=new PIXI.Graphics;t.beginFill(65280,.5);t.lineStyle(1,16776960,.8);t.drawCircle(0,0,10);t.drawRect(0,-3,30,6);t.endFill();return t}},{key:"_createRadar",value:function e(){var t=new PIXI.Graphics;t.beginFill(65280,.5);t.lineStyle(1,16776960,.8);t.drawRect(-3,-10,6,20);t.endFill();t.lineStyle();t.beginFill(11206570,.1);t.moveTo(0,-3);var n=300;var r=6;var i=n*Math.tan(r*(Math.PI/180))/2;t.lineTo(n,-i);t.lineTo(n,i);t.lineTo(0,3);return t}},{key:"_createLabel",value:function e(){var t=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:65280});var n=new PIXI.Text("",t);n.anchor.set(.5,.5);n.x=0;n.y=-40;return n}},{key:"_createHudBackground",value:function e(){var t=new PIXI.Graphics;t.beginFill(0,1);t.lineStyle(1,16776960,.8);t.drawRect(-26,-3,52,6);t.y=-30;return t}},{key:"_createEnergyBar",value:function e(){var t=new PIXI.Graphics;t.beginFill(65280,1);t.drawRect(0,-2,50,4);t.x=-25;t.y=-30;return t}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(27);var a=_(o);var s=n(47);var u=_(s);var l=n(48);var f=_(l);var c=n(49);var h=_(c);var d=n(50);var p=_(d);function _(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function m(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var b=function(e){m(t,e);function t(){y(this,t);var e=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"bw"));e._bigBoomAnim=[];e._smallBoomAnim=[];e._shakeTimer=0;return e}r(t,[{key:"onAssetsLoaded",value:function e(){for(var t=0;t<=9;t++){this._bigBoomAnim.push(PIXI.Texture.fromFrame("big_boom_00"+t));this._smallBoomAnim.push(PIXI.Texture.fromFrame("small_boom_00"+t))}}},{key:"initBatlefield",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initBatlefield",this).call(this,n)}},{key:"renderTank",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderTank",this).call(this,n,r);if(n.energy==0){this._shakeTimer=10;this._addExplosion(n.x,n.y,this._bigBoomAnim)}}},{key:"renderBullet",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderBullet",this).call(this,n,r);if(n.exploded){this._addExplosion(n.x,n.y,this._smallBoomAnim)}}},{key:"postRender",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"postRender",this).call(this);if(this._shakeTimer>0){this._shakeTimer--;this.masterContainer.x=Math.random()*10-5-this.offsetX;this.masterContainer.y=Math.random()*10-5-this.offsetY}else{this.masterContainer.x=-this.offsetX;this.masterContainer.y=-this.offsetY}}},{key:"_createBattlefieldView",value:function e(t){return new u.default(t)}},{key:"_createClockView",value:function e(t){return new f.default(t)}},{key:"_createBulletView",value:function e(t){return new h.default(t)}},{key:"_createTankView",value:function e(t){return new p.default(t)}},{key:"_addExplosion",value:function e(t,n,r){var i=new PIXI.extras.AnimatedSprite(r);i.anchor.set(.5);this.masterContainer.addChild(i);i.x=t;i.y=n;i.loop=false;i.onComplete=function(){this.stop();this.parent.removeChild(this)};i.play()}}]);return t}(a.default);t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(30);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}r(t,[{key:"_create",value:function e(t){var n=PIXI.Sprite.fromFrame("battlefield");t.addChild(n)}},{key:"update",value:function e(t){}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(30);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(e){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"_create",value:function e(t){var n=new PIXI.TextStyle({fontFamily:"Arial",fontSize:15,fill:"#000000"});this._label=new PIXI.Text("clock",n);this._label.x=10;this._label.y=600-20;t.addChild(this._label)}},{key:"update",value:function e(t){this._label.text=this.model.text}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(44);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(e){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"_create",value:function e(t){var n=PIXI.Sprite.fromFrame("bullet");n.anchor.set(.5);t.addChild(n)}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(31);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){f(t,e);function t(e){u(this,t);return l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"update",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,n);this._shoot.alpha=this.model.isShooting?1:this._shoot.alpha*.7}},{key:"_createBody",value:function e(){var t=PIXI.Sprite.fromFrame("tank_body");t.anchor.set(.5);return t}},{key:"_createGun",value:function e(){var t=new PIXI.Container;var n=PIXI.Sprite.fromFrame("tank_gun");n.anchor.set(.3,.5);t.addChild(n);this._shoot=PIXI.Sprite.fromFrame("tank_shoot");this._shoot.anchor.set(-1.2,.5);this._shoot.alpha=0;t.addChild(this._shoot);return t}},{key:"_createRadar",value:function e(){var t=PIXI.Sprite.fromFrame("tank_radar");t.anchor.set(.5);return t}},{key:"_createLabel",value:function e(){var t=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:0});var n=new PIXI.Text("",t);n.anchor.set(.5,.5);n.x=0;n.y=-40;return n}},{key:"_createHudBackground",value:function e(){var t=new PIXI.Graphics;t.beginFill(0,1);t.drawRect(-26,-3,52,6);t.y=-30;return t}},{key:"_createEnergyBar",value:function e(){var t=new PIXI.Graphics;t.beginFill(16711680,1);t.drawRect(0,-2,50,4);t.x=-25;t.y=-30;return t}}]);return t}(a.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(27);var a=v(o);var s=n(52);var u=v(s);var l=n(53);var f=v(l);var c=n(54);var h=v(c);var d=n(55);var p=v(d);var _=n(56);var y=v(_);function v(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function b(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var k=function(e){g(t,e);function t(){m(this,t);var e=b(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"brody"));e._bigBoomAnim=[];e._shakeTimer=0;e._particleContainer=null;e._particleList=[];e._explosionList=[];e._settings=new y.default;e._masterContainer.addChild(e._bulletContainer);e._frameTimer=0;e._frameCounter=0;e._fpsInterval=null;e._fps=30;return e}r(t,[{key:"onAssetsLoaded",value:function e(){var t=void 0;for(t=0;t<=22;t++){this._bigBoomAnim.push(PIXI.Texture.fromFrame("big_boom_0"+(t<10?"0"+t:t)))}}},{key:"initBatlefield",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initBatlefield",this).call(this,n);this.battlefieldView.configure(this._settings);this._particleContainer=new PIXI.particles.ParticleContainer(1e3,{position:true,rotation:true,alpha:true});this._masterContainer.addChild(this._particleContainer);this._masterContainer.addChild(this._hudContainer);var r=this;this._fpsInterval=setInterval(function(){r._fps=r._frameCounter;r._frameCounter=0},1e3)}},{key:"renderTank",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderTank",this).call(this,n,r);var o=void 0;for(o in r){if(r[o].type=="destroy"){this._shakeTimer=10;this._addTankExplosion(n);break}}var a=n.throttle>0?180:0;var s=(n.angle+a)*(Math.PI/180);if(n.speed>1){var u=n.x+20*Math.cos(s-Math.PI/4)+7*Math.cos(s);var l=n.y+20*Math.sin(s-Math.PI/4)+7*Math.sin(s);var f=n.x+20*Math.cos(s+Math.PI/4)+7*Math.cos(s);var c=n.y+20*Math.sin(s+Math.PI/4)+7*Math.sin(s);if(Math.random()<this.speedMultiplier){this._addDirt(u,l);this._addDirt(f,c)}}}},{key:"renderBullet",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"renderBullet",this).call(this,n,r);var o=this.getBulletView(n.id);o.configure(this._settings);if(n.exploded){this._addBulletExplosion(n);this.battlefieldView.addBulletHole(n.x,n.y,n.power)}}},{key:"preRender",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"preRender",this).call(this);var n=void 0;var r=0;var o=void 0;for(o=this._particleList.length-1;o>=0;o--){n=this._particleList[o];if(!n){continue}n.x+=this.speedMultiplier*n.speed*n.rotation*Math.cos(n.rotation);n.y+=this.speedMultiplier*n.speed*n.rotation*Math.sin(n.rotation);n.alpha=Math.max(0,n.alpha-this.speedMultiplier*n.alphaSpeed);n.lifetime-=this.speedMultiplier;if(n.lifetime<=0||r>this._settings.particleLimit){n.parent.removeChild(n);this._particleList[o]=null}else{r++}}for(o=0;o<this._explosionList.length;o++){if(!this._explosionList[o])continue;this._explosionList[o].alpha=this._explosionList[o].alpha-.12*this.speedMultiplier;if(this._explosionList[o].alpha<.01){this._explosionList[o].parent.removeChild(this._explosionList[o]);this._explosionList[o]=null}}}},{key:"postRender",value:function e(){this._frameTimer++;this._frameCounter++;if(this._frameTimer%this._settings.dropFrames==0){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"postRender",this).call(this)}if(this._shakeTimer>0){this._shakeTimer--;this.masterContainer.x=Math.random()*10-5-this.offsetX;this.masterContainer.y=Math.random()*10-5-this.offsetY;this._battlefieldView.view.x=Math.random()*10-5;this._battlefieldView.view.y=Math.random()*10-5}else{this.masterContainer.x=-this.offsetX;this.masterContainer.y=-this.offsetY;this._battlefieldView.view.x=0;this._battlefieldView.view.y=0}}},{key:"stop",value:function e(){if(this._fpsInterval){clearInterval(this._fpsInterval)}}},{key:"_addTankExplosion",value:function e(t){this._addExplosion(t.x,t.y,this._bigBoomAnim);this.battlefieldView.addCrater(t.x,t.y);this._addSparks(t.x,t.y,300)}},{key:"_addBulletExplosion",value:function e(t){this._addGlow(t.x,t.y,.3+.6*t.power);var n=5+40*t.power;this._addSparks(t.x,t.y,n)}},{key:"_createBattlefieldView",value:function e(t){return new u.default(t)}},{key:"_createClockView",value:function e(t){return new f.default(t)}},{key:"_createBulletView",value:function e(t){return new h.default(t)}},{key:"_createTankView",value:function e(t){return new p.default(t)}},{key:"_addExplosion",value:function e(t,n,r){this._addGlow(t,n,5);var i=new PIXI.extras.AnimatedSprite(r);i.animationSpeed=this.speedMultiplier;i.anchor.set(.5);this.masterContainer.addChild(i);i.x=t;i.y=n;i.loop=false;i.blendMode=PIXI.BLEND_MODES.ADD;i.onComplete=function(){this.stop();this.parent.removeChild(this)};i.play()}},{key:"_addGlow",value:function e(t,n,r){if(!this._settings.showGlow)return;var i=PIXI.Sprite.fromFrame("glow");i.anchor.set(.5);i.scale.x=i.scale.y=r;i.alpha=.4;i.blendMode=PIXI.BLEND_MODES.ADD;i.x=t;i.y=n;this.masterContainer.addChild(i);this._explosionList.push(i)}},{key:"_addSparks",value:function e(t,n,r){r=Math.ceil(r*this._settings.quality);for(var i=0;i<r;i++){var o=PIXI.Sprite.fromFrame("spark");o.x=t;o.y=n;o.alphaSpeed=0;o.anchor.set(.5);o.speed=1+Math.random()*2;o.rotation=Math.random()*2*Math.PI;o.lifetime=5+Math.random()*5;this._particleContainer.addChild(o);this._particleList.push(o)}}},{key:"_addDirt",value:function e(t,n){if(!this._settings.showDirt)return;for(var r=0;r<5;r++){var i=Math.floor(Math.random()*3);var o=PIXI.Sprite.fromFrame("dirt_"+i);o.x=t+Math.random()*4-2;o.y=n+Math.random()*4-2;o.anchor.set(.5);o.speed=0;o.alphaSpeed=.02+Math.random()*.02;o.rotation=0;o.alpha=.1+.4*Math.random();o.lifetime=25;o.scale.x=o.scale.y=.5+2*Math.random();this._particleContainer.addChild(o);this._particleList.push(o)}}},{key:"quality",get:function e(){return this._settings.quality},set:function e(t){this._settings.quality=t}}]);return t}(a.default);t.default=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(30);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){f(t,e);function t(e){u(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n._holeList=[];n._settings=null;return n}r(t,[{key:"configure",value:function e(t){this._settings=t}},{key:"_create",value:function e(t){var n=PIXI.Sprite.fromFrame("battlefield");t.addChild(n);var r=new PIXI.Graphics;r.beginFill(255,1);r.moveTo(25,25);r.lineTo(900-25,25);r.lineTo(900-25,600-25);r.lineTo(90,600-25);r.lineTo(90,600-35);r.lineTo(25,600-35);r.lineTo(25,25);r.endFill();this._craterContainer=new PIXI.Container;this._craterContainer.mask=r;t.addChild(this._craterContainer);t.addChild(r);var i=new PIXI.Graphics;i.beginFill(255,.4);i.moveTo(15,15);i.lineTo(900-15,15);i.lineTo(900-15,600-15);i.lineTo(80,600-15);i.lineTo(80,600-25);i.lineTo(15,600-25);i.lineTo(15,15);i.lineTo(25,25);i.lineTo(25,600-25);i.lineTo(80,600-25);i.lineTo(80,600-25);i.lineTo(900-25,600-25);i.lineTo(900-25,25);i.lineTo(25,25);i.endFill();this._holesContainer=new PIXI.Container;this._holesContainer.mask=i;t.addChild(this._holesContainer);t.addChild(i)}},{key:"addCrater",value:function e(t,n){var r=PIXI.Sprite.fromFrame("crater");r.anchor.set(.5);r.x=t-this.model.offsetX;r.y=n-this.model.offsetY;r.blendMode=PIXI.BLEND_MODES.MULTIPLY;r.alpha=.8;this._craterContainer.addChild(r)}},{key:"update",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this);this._holesContainer.visible=this._settings.skratchLimit>0;this._craterContainer.visible=this._settings.showCraters}},{key:"addBulletHole",value:function e(t,n,r){var i=0;if(Math.abs(n-this.model.maxY)<10){n=this.model.maxY+3+Math.random()*3}else if(Math.abs(n-this.model.minY)<10){n=this.model.minY-3-Math.random()*3}else if(Math.abs(t-this.model.maxX)<10){t=this.model.maxX+3+Math.random()*3;i=Math.PI/2}else if(Math.abs(t-this.model.minX)<10){t=this.model.minX-3-Math.random()*3;i=Math.PI/2}else{return}var o=PIXI.Sprite.fromFrame("hole");o.anchor.set(.5);o.x=t-this.model.offsetX;o.y=n-this.model.offsetY;o.rotation=i;o.scale.x=o.scale.y=.7+.5*r;this._holesContainer.addChild(o);this._holeList.push(o);var a=this._settings?this._settings.skratchLimit:20;while(this._holeList.length>a){o=this._holeList.shift();o.parent.removeChild(o)}}}]);return t}(a.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=n(30);var o=a(i);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=function(e){l(t,e);function t(e){s(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"_create",value:function e(t){var n=new PIXI.TextStyle({fontFamily:"Arial",fontSize:15,fill:"#000000"});this._label=new PIXI.Text("clock",n);this._label.x=10;this._label.y=600-20;t.addChild(this._label)}},{key:"update",value:function e(t){this._label.text=this.model.text}}]);return t}(o.default);t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(44);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){f(t,e);function t(e,n){u(this,t);return l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}r(t,[{key:"configure",value:function e(t){this._settings=t}},{key:"update",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,n);this._glow.visible=this._settings&&this._settings.showGlow}},{key:"_create",value:function e(t){var n=PIXI.Sprite.fromFrame("bullet");n.anchor.set(.5);var r=PIXI.Sprite.fromFrame("glow");r.anchor.set(.5);r.blendMode=PIXI.BLEND_MODES.ADD;r.alpha=.1;this._glow=r;t.addChild(r);t.addChild(n)}}]);return t}(a.default);t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=n(31);var a=s(o);function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function l(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=function(e){f(t,e);function t(e){u(this,t);var n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n._lightTimer=0;return n}r(t,[{key:"update",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,n);this._shoot.alpha=this._shoot.alpha*.8;this._tankGun.x=this._tankGun.x*.8;this.radar.rotation=(-this.model.gunAngle+this._model.radarAngle)*(Math.PI/180);this._lightTimer=this.model.enemySpot?this._lightTimer+1:0;this._light.alpha=-Math.cos(this._lightTimer*.25)*.5+.5}},{key:"_onShoot",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onShoot",this).call(this,n);this._tankGun.x=-1-3*n.bullet.power;this._shoot.alpha=1}},{key:"_create",value:function e(n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_create",this).call(this,n);this._tankGun.addChild(this.radar)}},{key:"_createBody",value:function e(){var t=PIXI.Sprite.fromFrame("tank_body_"+this.model.skin);t.anchor.set(.3,.5);return t}},{key:"_createGun",value:function e(){var t=new PIXI.Container;var n=PIXI.Sprite.fromFrame("tank_gun_"+this.model.skin);n.anchor.set(.3,.5);t.addChild(n);this._tankGun=n;this._shoot=PIXI.Sprite.fromFrame("tank_shoot");this._shoot.anchor.set(.3,.5);this._shoot.alpha=0;this._light=PIXI.Sprite.fromFrame("tank_light");this._light.anchor.set(.3,.5);this._light.alpha=0;t.addChild(this._shoot);t.addChild(this._light);return t}},{key:"_createRadar",value:function e(){var t=PIXI.Sprite.fromFrame("tank_radar_"+this.model.skin);t.anchor.set(.2,.5);t.x=-5;return t}},{key:"_createLabel",value:function e(){var t=new PIXI.TextStyle({fontFamily:"Arial",fontSize:10,stroke:0,strokeThickness:2,fill:16777147});var n=new PIXI.Text("",t);n.anchor.set(.5,.5);n.x=0;n.y=-40;return n}},{key:"_createHudBackground",value:function e(){var t=new PIXI.Graphics;t.beginFill(0,1);t.drawRect(-26,-3,52,6);t.y=-30;return t}},{key:"_createEnergyBar",value:function e(){var t=new PIXI.Graphics;t.beginFill(16777113,1);t.drawRect(0,-2,50,4);t.x=-25;t.y=-30;return t}}]);return t}(a.default);t.default=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t){r(this,e);this._particleLimit=1e3;this._skratchLimit=100;this._showDirt=true;this._showGlow=true;this._showCraters=true;this._dropFrames=1;this._quality=1;this.quality=this._quality}n(e,[{key:"dropFrames",get:function e(){return this._dropFrames}},{key:"particleLimit",get:function e(){return this._particleLimit}},{key:"skratchLimit",get:function e(){return this._skratchLimit}},{key:"showDirt",get:function e(){return this._showDirt}},{key:"showGlow",get:function e(){return this._showGlow}},{key:"showCraters",get:function e(){return this._showCraters}},{key:"quality",get:function e(){return this._quality},set:function e(t){t=Math.min(1,Math.max(0,t));this._quality=t;this._particleLimit=Math.round(1e3*t*t);this._skratchLimit=Math.round(100*t);this._showDirt=t>.2;this._showGlow=t>.5;this._showCraters=t>.1;if(t>.3){this._dropFrames=1}else if(t>.2){this._dropFrames=2}else if(t>.1){this._dropFrames=3}else{this._dropFrames=4}this._quality=t}}]);return e}();t.default=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=false;var o=function(){function e(){r(this,e);var t=(new Date).getTime().toString();t=t.substr(t.length-6,6)+""+Math.round(1e7*Math.random());t=Number(t);t=t.toString(35);this._name="";this._team=t;this._code=null;this._initData=null;this._useSandbox=true;this._executionLimit=100}n(e,[{key:"fromFile",value:function e(t,n){if(!t)throw"TankName is required";this._name=t;this._code=null;this._initData=n!==undefined?n:null}},{key:"fromCode",value:function e(t,n,r){if(!t)throw"TankName is required";if(!n)throw"Code is required";n=n.replace(/importScripts\w*\([^\)]*\)/g,"");this._name=t;this._code=n;this._initData=r!==undefined?r:null}},{key:"assignToTeam",value:function e(t){this._team=t}},{key:"disableSandbox",value:function e(){if(!this._code){throw"Sandbox can be disabled for AI created from code only."}if(!i){console.warn("Disabling sandbox for AI! It could be dangerous.");i=true}this._useSandbox=false}},{key:"name",get:function e(){return this._name}},{key:"teamName",get:function e(){return this._team}},{key:"executionLimit",get:function e(){return this._executionLimit},set:function e(t){this._executionLimit=t}},{key:"filePath",get:function e(){if(!this._useSandbox)return null;if(this._code){return"tanks/lib/codeWorker.js"}else{return"tanks/"+this._name+".tank.js"}}},{key:"code",get:function e(){return this._code}},{key:"initData",get:function e(){return this._initData}},{key:"useSandbox",get:function e(){return this._useSandbox}}]);return e}();t.default=o}]);
//# sourceMappingURL=jsbattle.min.js.map